<!DOCTYPE html>
<html lang="it">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <title>Vivi Consapevolmente</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ§˜</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap">
    <style>
        :root {
            --primary: #0d9488;
            --primary-light: #5eead4;
            --primary-dark: #115e59;
            --primary-darker: #0f766e;
            --background: #f0fdfa;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text: #334155;
            --text-light: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
            --calm-1: #a7f3d0;
            --calm-2: #99f6e4;
            --calm-3: #c7d2fe;
            --premium: #0d9488;
            --premium-light: #5eead4;
            --premium-gradient: linear-gradient(135deg, #0d9488, #115e59);
            --journey-1: #0d9488;
            --journey-2: #5eead4;
            --journey-3: #115e59;
            --streak-gradient: linear-gradient(135deg, #5eead4, #0d9488);
            --streak-height: 120px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Nunito', 'Segoe UI', system-ui, sans-serif;
            touch-action: manipulation;
        }

        body {
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding-bottom: 100px;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            transition: background 0.3s ease, color 0.3s ease;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%235eead4' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        body.dark-theme {
            --background: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.95);
            --text: #e2e8f0;
            --text-light: #94a3b8;
            --primary: #14b8a6;
            --primary-dark: #0d9488;
            --primary-darker: #0f766e;
            --calm-1: #0d9488;
            --calm-2: #115e59;
            --calm-3: #1e293b;
            --streak-gradient: linear-gradient(135deg, #0f766e, #115e59);
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%230f766e' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        /* Onboarding Section */
        #onboarding {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.5s ease-in-out;
        }

        .onboarding-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .onboarding-slide {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .onboarding-slide.active {
            display: block;
        }

        .onboarding-emoji {
            font-size: 5rem;
            margin-bottom: 30px;
            animation: float 4s ease-in-out infinite;
        }

        .onboarding-title {
            font-size: 2.2rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .onboarding-text {
            font-size: 1.1rem;
            margin-bottom: 30px;
            max-width: 90%;
            line-height: 1.8;
        }

        .terms-container {
            margin: 20px 0;
            text-align: left;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            max-width: 90%;
        }

        .terms-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .terms-checkbox input {
            width: 20px;
            height: 20px;
        }

        .terms-links {
            font-size: 0.9rem;
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 10px;
        }

        .terms-links a {
            color: white;
            text-decoration: underline;
        }

        .onboarding-btn {
            background: white;
            color: var(--primary-dark);
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: var(--shadow-lg);
        }

        .onboarding-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .onboarding-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .container {
            max-width: 100%;
            width: 100%;
            padding: 0 15px;
            margin: 0 auto;
        }

        .section {
            display: none;
            padding: 20px 15px 120px;
            animation: fadeIn 0.4s ease-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-top: 15px;
        }

        .header h1 {
            font-size: 1.8rem;
            color: var(--primary-dark);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 18px;
            box-shadow: var(--shadow-lg);
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(13, 148, 136, 0.2);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.15);
        }

        .card-title {
            font-size: 1.25rem;
            color: var(--primary-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .daily-card {
            position: relative;
            height: 200px;
            border-radius: 18px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .daily-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .daily-card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            padding: 20px;
            color: white;
        }

        .daily-card-overlay h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .streak-card {
            background: var(--streak-gradient);
            color: white;
            border-radius: 18px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
            height: var(--streak-height);
        }

        .streak-card::after {
            content: "";
            position: absolute;
            top: -20px;
            right: -20px;
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
        }

        .streak-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 5px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .streak-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .mood-tracker {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            overflow-x: auto;
            padding-bottom: 10px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-light) transparent;
        }

        .mood-tracker::-webkit-scrollbar {
            height: 5px;
        }

        .mood-tracker::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 10px;
        }

        .mood-btn {
            background: none;
            border: none;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px;
            border-radius: 50%;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
            flex-shrink: 0;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mood-btn:hover {
            transform: scale(1.15);
            background: rgba(94, 234, 212, 0.2);
        }

        .mood-btn:active, .mood-btn.active {
            background: var(--primary-darker);
            transform: scale(1.1);
        }

        .mood-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .mood-status {
            text-align: center;
            padding: 12px;
            border-radius: 12px;
            background: linear-gradient(to right, var(--calm-1), var(--calm-2));
            color: var(--primary-dark);
            font-size: 0.95rem;
            margin: 10px 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .meditation-list {
            display: grid;
            gap: 15px;
        }

        .meditation-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            will-change: transform, box-shadow;
            border: 1px solid rgba(13, 148, 136, 0.1);
            cursor: pointer;
            position: relative;
        }

        .meditation-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(to right, rgba(167, 243, 208, 0.1), rgba(153, 246, 228, 0.1));
        }

        .meditation-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--calm-1), var(--calm-3));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary-dark);
            margin-right: 15px;
            transition: all 0.3s ease;
        }

        .meditation-info {
            flex: 1;
        }

        .meditation-title {
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--primary-dark);
        }

        .meditation-desc {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .download-btn {
            background: transparent;
            border: none;
            color: var(--text-light);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            color: var(--primary);
            background: rgba(13, 148, 136, 0.1);
        }

        .player-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .player-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .player-container {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .player-header {
            padding: 20px;
            text-align: center;
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
        }

        .player-body {
            padding: 25px 20px;
            background: linear-gradient(to bottom, #f0fdfa, #e0f2fe);
        }

        .player-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .player-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.2s ease, background 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .player-btn:hover {
            transform: scale(1.1);
            background: var(--primary-dark);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .player-btn:active {
            transform: scale(0.95);
        }

        .player-close {
            display: block;
            width: 100%;
            padding: 12px;
            background: #f1f5f9;
            color: var(--text);
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: 20px;
        }

        .player-close:hover {
            background: #e2e8f0;
        }

        .player-close:active {
            background: #d1d8e0;
        }

        .history-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .history-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .history-container {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            padding: 25px;
            max-height: 85vh;
            overflow-y: auto;
            background: linear-gradient(to bottom, #f0fdfa, #e0f2fe);
            margin: 20px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .history-title {
            font-size: 1.5rem;
            color: var(--primary-dark);
        }

        .history-close {
            font-size: 1.8rem;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .history-close:hover {
            background: #f1f5f9;
            color: var(--text);
        }

        .history-close:active {
            background: #e2e8f0;
            transform: scale(0.9);
        }

        .mood-bar-container {
            margin: 20px 0;
        }

        .mood-bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .mood-bar {
            height: 20px;
            width: 100%;
            background: linear-gradient(to right, #ef4444, #f59e0b, #10b981);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .mood-bar-indicator {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 6px;
            background: white;
            border-radius: 3px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
        }

        .history-section {
            margin-bottom: 30px;
        }

        .history-section-title {
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary-light);
        }

        .calendar-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
        }

        .calendar-nav-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--primary);
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .calendar-nav-btn:hover {
            background: rgba(94, 234, 212, 0.2);
        }

        .calendar-nav-btn:active {
            background: rgba(94, 234, 212, 0.3);
            transform: scale(0.95);
        }

        .calendar-month {
            font-weight: 700;
            color: var(--primary-dark);
            font-size: 1.1rem;
        }

        .calendar-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .calendar-header {
            text-align: center;
            font-weight: 700;
            padding: 8px 0;
            color: var(--primary-dark);
            font-size: 0.9rem;
        }

        .calendar-day {
            text-align: center;
            padding: 10px 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            background: rgba(255, 255, 255, 0.7);
            position: relative;
        }

        .calendar-day:hover {
            background: rgba(94, 234, 212, 0.2);
        }

        .calendar-day:active {
            background: var(--primary);
            color: white;
        }

        .calendar-day.active {
            background: var(--primary);
            color: white;
            font-weight: 700;
        }

        .calendar-day.has-data::after {
            content: 'ðŸ”¥';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
        }

        .profile-edit-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .profile-edit-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .profile-edit-container {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            padding: 25px;
            background: linear-gradient(to bottom, #f0fdfa, #e0f2fe);
            margin: 20px;
        }

        .profile-edit-title {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary-dark);
            font-size: 1.4rem;
        }

        .emoji-picker {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
            padding: 0 15px;
        }

        .emoji-option {
            font-size: 2rem;
            text-align: center;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1;
        }

        .emoji-option:hover, .emoji-option.selected {
            background: rgba(94, 234, 212, 0.2);
            transform: scale(1.1);
        }

        .emoji-option:active {
            transform: scale(0.95);
        }

        .gender-selection {
            margin-bottom: 20px;
        }

        .gender-options {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .gender-option {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        .gender-option.selected {
            border-color: var(--primary);
            background: rgba(94, 234, 212, 0.1);
            color: var(--primary-dark);
            font-weight: 600;
        }

        .gender-option:active {
            transform: scale(0.95);
        }

        .profile-edit-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .profile-edit-cancel,
        .profile-edit-save {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 1rem;
        }

        .profile-edit-cancel {
            background: #f1f5f9;
            color: var(--text);
        }

        .profile-edit-cancel:hover {
            background: #e2e8f0;
        }

        .profile-edit-save {
            background: var(--primary);
            color: white;
        }

        .profile-edit-save:hover {
            background: var(--primary-dark);
        }

        .toast {
            position: fixed;
            bottom: 120px;
            right: 15px;
            background: var(--primary-dark);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 100;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.4s ease;
            max-width: 300px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08);
            z-index: 100;
            display: flex;
            padding: 12px 0;
            border-top: 1px solid #f1f5f9;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 0;
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.75rem;
            transition: all 0.3s ease;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-icon {
            font-size: 1.4rem;
            margin-bottom: 4px;
        }

        .nav-item:active {
            color: var(--primary-darker);
            transform: scale(0.95);
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            z-index: 50;
            border: 1px solid rgba(13, 148, 136, 0.1);
        }

        .reminder-settings {
            display: grid;
            gap: 15px;
            margin-top: 15px;
        }

        .reminder-item {
            background: rgba(94, 234, 212, 0.1);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(13, 148, 136, 0.2);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        .reminder-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .reminder-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .reminder-control {
            display: flex;
            flex-direction: column;
        }

        .reminder-control label {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .reminder-control select,
        .reminder-control input {
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%230d9488' viewBox='0 0 16 16'%3E%3Cpath d='M8 11.5a.5.5 0 0 1-.354-.854l3.646-3.646a.5.5 0 0 1 .708.708L8.707 11.5a.5.5 0 0 1-.707 0z'/%3E%3Cpath d='M8 4.5a.5.5 0 0 1 .354.854l-3.646 3.646a.5.5 0 0 1-.708-.708L7.293 4.5a.5.5 0 0 1 .707 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
            color: var(--text);
        }

        .reminder-control input {
            background-image: none;
        }

        .gratitude-form {
            display: grid;
            gap: 12px;
        }

        .gratitude-input {
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            color: var(--text);
        }

        .gratitude-input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(94, 234, 212, 0.3);
        }

        .gratitude-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: 10px;
            font-size: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .gratitude-btn:hover {
            background: var(--primary-dark);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .gratitude-btn:active {
            background: var(--primary-darker);
            transform: scale(0.98);
        }

        .profile-header {
            display: flex;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 15px;
        }

        .profile-emoji {
            font-size: 3rem;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--calm-1), var(--calm-3));
            border-radius: 50%;
            margin-right: 20px;
            box-shadow: var(--shadow);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }

        .profile-welcome {
            color: var(--text-light);
            font-size: 1rem;
        }

        .profile-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 16px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        .profile-item:hover {
            background: linear-gradient(to right, rgba(167, 243, 208, 0.1), rgba(153, 246, 228, 0.1));
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .profile-item:active {
            transform: translateY(0);
            background: rgba(94, 234, 212, 0.2);
        }

        .profile-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--calm-1), var(--calm-3));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-right: 15px;
        }

        .profile-text {
            font-weight: 600;
            color: var(--text);
        }

        .calm-element {
            position: fixed;
            pointer-events: none;
            z-index: -1;
            opacity: 0.1;
            margin: 20px;
        }

        .calm-leaf {
            font-size: 4rem;
            color: var(--primary);
        }

        .calm-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--calm-1);
            filter: blur(20px);
        }

        .goal-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .goal-input-container {
            display: flex;
            gap: 10px;
            flex-direction: column;
        }

        .goal-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            color: var(--text);
        }

        .goal-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .goal-btn:hover {
            background: var(--primary-dark);
        }

        .goal-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary-light);
        }

        .goal-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--text-light);
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .goal-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .goal-text {
            flex: 1;
            font-size: 1rem;
            color: var(--text);
        }

        .goal-text.completed {
            text-decoration: line-through;
            color: var(--text-light);
        }

        .goal-status {
            font-size: 0.85rem;
            color: var(--text-light);
            text-align: right;
        }

        .goal-history-item {
            padding: 10px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            align-items: center;
        }

        .goal-history-icon {
            font-size: 1.2rem;
            margin-right: 10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .goal-history-icon.completed {
            background: var(--success);
            color: white;
        }

        .goal-history-icon.not-completed {
            background: var(--error);
            color: white;
        }

        .premium-description {
            padding: 10px 0;
        }

        .premium-description ul {
            list-style-type: none;
            padding: 10px 0;
        }

        .premium-description li {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .premium-description li i {
            color: var(--premium);
            margin-right: 10px;
        }

        .subscription-switch {
            display: flex;
            justify-content: space-between;
            background: #f1f5f9;
            border-radius: 12px;
            padding: 5px;
            margin: 15px 0;
        }

        .subscription-option {
            flex: 1;
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .subscription-option.active {
            background: white;
            box-shadow: var(--shadow);
            border: 1px solid var(--primary-light);
        }

        .plan-name {
            font-weight: 600;
            color: var(--primary-dark);
        }

        .plan-price {
            font-size: 0.9rem;
            color: var(--text);
        }

        .discount {
            color: var(--success);
            font-size: 0.8rem;
            font-weight: 600;
        }

        .subscribe-btn {
            width: 100%;
            padding: 14px;
            background: var(--premium);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-bottom: 10px;
            font-size: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: block;
        }

        .subscribe-btn:hover {
            background: #0f766e;
        }

        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .login-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .login-container {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            padding: 30px;
            text-align: center;
        }

        .login-header {
            margin-bottom: 25px;
        }

        .app-logo {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--calm-1), var(--calm-3));
            border-radius: 20px;
            font-size: 3.5rem;
            color: var(--primary-dark);
            box-shadow: var(--shadow);
        }

        .app-name {
            font-size: 1.8rem;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }

        .app-tagline {
            color: var(--text-light);
            font-size: 1rem;
        }

        .google-login-btn {
            width: 100%;
            padding: 14px;
            background: #4285F4;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .google-login-btn:hover {
            background: #3367d6;
        }

        .login-close {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.95rem;
        }

        .journey-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .journey-item {
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid transparent;
        }

        .journey-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .journey-header {
            padding: 20px;
            color: white;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .journey-1 .journey-header {
            background: linear-gradient(135deg, var(--journey-1), #0a7a6f);
        }

        .journey-2 .journey-header {
            background: linear-gradient(135deg, var(--journey-2), #0d9488);
        }

        .journey-3 .journey-header {
            background: linear-gradient(135deg, var(--journey-3), #0a625b);
        }

        .journey-title {
            font-size: 1.2rem;
            font-weight: 700;
            z-index: 1;
        }

        .journey-duration {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .journey-status {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 1;
        }

        .journey-body {
            padding: 15px;
            background: white;
        }

        .journey-progress {
            margin-bottom: 15px;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .progress-bar {
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 5px;
        }

        .journey-1 .progress-fill {
            background: var(--journey-1);
        }

        .journey-2 .progress-fill {
            background: var(--journey-2);
        }

        .journey-3 .progress-fill {
            background: var(--journey-3);
        }

        .journey-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1rem;
        }

        .journey-1 .journey-btn {
            background: var(--journey-1);
            color: white;
        }

        .journey-2 .journey-btn {
            background: var(--journey-2);
            color: white;
        }

        .journey-3 .journey-btn {
            background: var(--journey-3);
            color: white;
        }

        .journey-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .journey-btn:active {
            transform: translateY(0);
        }

        .journey-locked {
            background: #e2e8f0;
            color: var(--text-light);
            cursor: not-allowed;
        }

        .journey-locked:hover {
            transform: none;
            opacity: 1;
        }

        .journey-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .journey-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .journey-container {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-height: 85vh;
            overflow-y: auto;
            background: linear-gradient(to bottom, #f0fdfa, #e0f2fe);
            margin: 20px;
            padding: 25px;
        }

        .journey-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .journey-modal-title {
            font-size: 1.5rem;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }

        .journey-close {
            font-size: 1.8rem;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .journey-close:hover {
            background: #f1f5f9;
            color: var(--text);
        }

        .journey-close:active {
            background: #e2e8f0;
            transform: scale(0.9);
        }

        .current-day {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 12px;
            background: #f8fafc;
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 1.1rem;
        }

        .day-number {
            display: inline-block;
            width: 35px;
            height: 35px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            line-height: 35px;
            margin-right: 10px;
        }

        .task-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
        }

        .task-title {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-description {
            color: var(--text-light);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .task-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .checkbox-label {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            color: var(--text);
        }

        .checkbox-custom {
            width: 24px;
            height: 24px;
            border: 2px solid var(--text-light);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        input[type="checkbox"]:checked + .checkbox-label .checkbox-custom {
            background: var(--success);
            border-color: var(--success);
        }

        input[type="checkbox"]:checked + .checkbox-label .checkbox-custom::after {
            content: "âœ“";
            color: white;
        }

        input[type="checkbox"] {
            display: none;
        }

        .task-completed {
            text-align: center;
            padding: 15px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 12px;
            color: var(--success);
            font-weight: 600;
            margin-top: 15px;
            display: none;
        }

        .journey-section {
            margin-top: 25px;
        }

        .journey-section-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-dark);
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary-light);
        }

        .journey-days {
            display: grid;
            gap: 10px;
        }

        .day-item {
            padding: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8fafc;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .day-item:hover {
            background: #f1f5f9;
        }

        .day-item.completed {
            background: rgba(16, 185, 129, 0.1);
        }

        .day-check {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .day-item.completed .day-check {
            background: var(--success);
            color: white;
        }

        .day-info {
            flex: 1;
        }

        .day-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text);
        }

        .day-desc {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        /* Intention styling */
        .intention-container {
            padding: 15px;
            background: rgba(94, 234, 212, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(13, 148, 136, 0.2);
        }

        .intention-text {
            font-style: italic;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .intention-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
            width: 100%;
        }

        .intention-btn:hover {
            background: var(--primary-dark);
        }

        /* Delete account button */
        .delete-account-btn {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
            border: 1px solid rgba(239, 68, 68, 0.2);
            padding: 12px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-align: center;
            margin-top: 15px;
        }

        .delete-account-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        /* Responsive */
        @media (min-width: 768px) {
            .container {
                max-width: 750px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .daily-card {
                height: 250px;
            }

            .nav-bar {
                padding: 15px 0;
            }

            .goal-input-container {
                flex-direction: row;
            }

            .profile-header {
                flex-direction: row;
                text-align: left;
            }

            .profile-emoji {
                margin-right: 20px;
                margin-bottom: 0;
            }

            .calm-element {
                opacity: 0.15;
            }
            .calm-element:nth-child(1) {
                top: 10%;
                left: 10%;
            }
            .calm-element:nth-child(2) {
                top: 25%;
                right: 10%;
            }
            .calm-element:nth-child(3) {
                top: 60%;
                left: 15%;
            }
            .calm-element:nth-child(4) {
                bottom: 20%;
                right: 8%;
            }

            .emoji-picker {
                grid-template-columns: repeat(6, 1fr);
                gap: 15px;
                padding: 0 20px;
            }

            .emoji-option {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 768px) {
            .reminder-item {
                min-height: auto;
                padding: 12px;
            }

            .reminder-controls {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .calendar-header {
                font-size: 0.8rem;
                padding: 5px 0;
            }

            .calendar-day {
                padding: 8px 3px;
                font-size: 0.8rem;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .profile-emoji {
                margin-right: 0;
                margin-bottom: 15px;
            }

            .emoji-picker {
                grid-template-columns: repeat(4, 1fr);
                padding: 0 10px;
                gap: 12px;
            }

            .emoji-option {
                font-size: 1.8rem;
                padding: 12px;
            }

            .subscription-switch {
                flex-direction: column;
            }

            .calm-element {
                opacity: 0.08;
                margin: 20px;
            }
            .calm-element:nth-child(1) {
                top: 5% !important;
                left: 5% !important;
            }
            .calm-element:nth-child(2) {
                top: 10% !important;
                right: 5% !important;
            }
            .calm-element:nth-child(3) {
                top: 75% !important;
                left: 5% !important;
            }
            .calm-element:nth-child(4) {
                bottom: 5% !important;
                right: 5% !important;
            }

            .journey-title {
                font-size: 1.1rem;
            }

            .journey-duration {
                font-size: 0.8rem;
            }

            .journey-status {
                font-size: 0.75rem;
                padding: 3px 8px;
            }

            .journey-btn {
                padding: 10px;
                font-size: 0.9rem;
            }

            .journey-modal-container {
                padding: 15px;
            }

            .journey-modal-title {
                font-size: 1.3rem;
            }
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: auto;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .review-message {
            text-align: center;
            margin-top: 15px;
            color: var(--success);
            font-weight: 600;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .floating {
            animation: float 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.05); opacity: 0.5; }
            100% { transform: scale(1); opacity: 0.7; }
        }

        .pulse {
            animation: pulse 3s ease-in-out infinite;
        }

        .premium-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 18px;
            padding: 25px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(13, 148, 136, 0.2);
            color: white;
        }

        .premium-card::before {
            content: "";
            position: absolute;
            top: -50px;
            right: -50px;
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            opacity: 0.3;
        }

        .premium-card::after {
            content: "";
            position: absolute;
            bottom: -30px;
            left: -30px;
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            opacity: 0.2;
        }

        .premium-title {
            font-size: 1.4rem;
            color: white;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .premium-features {
            position: relative;
            z-index: 1;
        }

        .premium-features li {
            padding: 8px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.2);
        }

        .premium-features li:last-child {
            border-bottom: none;
        }

        .premium-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: white;
            color: var(--primary-dark);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            transform: rotate(5deg);
        }

        .subscribe-container {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .subscribe-option {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            color: var(--text);
        }

        .subscribe-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }

        .subscribe-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .subscribe-name {
            font-weight: 700;
            color: var(--primary-dark);
        }

        .subscribe-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .subscribe-desc {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 15px;
        }

        .subscribe-btn-premium {
            background: white;
            color: var(--primary-dark);
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .subscribe-btn-premium:hover {
            background: #f1f5f9;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .referral-card {
            background: linear-gradient(135deg, #dbf9ff, #c7f3fe);
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(13, 148, 136, 0.2);
        }

        .referral-card::before {
            content: "";
            position: absolute;
            top: -30px;
            right: -30px;
            width: 80px;
            height: 80px;
            background: rgba(199, 243, 254, 0.4);
            border-radius: 50%;
            opacity: 0.4;
        }

        .referral-title {
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .referral-description {
            margin-bottom: 15px;
            color: var(--text);
            line-height: 1.6;
        }

        .referral-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .referral-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }

        .time-range {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .time-input {
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            width: 100%;
            text-align: center;
            color: var(--text);
        }

        .price-tagline {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 5px;
            text-align: center;
            font-style: italic;
        }

        .trial-badge {
            background: var(--success);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-top: 5px;
            display: inline-block;
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.1) !important;
            color: var(--error) !important;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2) !important;
        }

        /* Journey improvements */
        .journey-btn:active {
            transform: scale(0.98);
            opacity: 0.95;
        }

        /* Intention input */
        .intention-input {
            padding: 12px 15px;
            border: 1px solid var(--primary-light);
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
            margin-bottom: 10px;
            width: 100%;
        }

        .intention-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Meditation filters */
        .meditation-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .filter-btn {
            padding: 10px 15px;
            border-radius: 50px;
            background: rgba(13, 148, 136, 0.1);
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
        }

        .filter-btn:hover {
            background: rgba(13, 148, 136, 0.2);
        }

        .filter-btn:active {
            transform: scale(0.95);
        }

        /* Journey day styles */
        .day-item.locked {
            filter: blur(2px);
            cursor: not-allowed;
            pointer-events: none;
        }

        .day-item.future {
            opacity: 0.6;
            filter: blur(1px);
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Subscription price adjustments */
        .price-details {
            font-size: 0.85rem;
            color: var(--text-light);
            text-align: center;
            margin-top: 5px;
        }

        .price-note {
            font-size: 0.75rem;
            color: var(--text-light);
            font-style: italic;
            margin-top: 3px;
        }

        /* Manage subscription button */
        .manage-subscription-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            display: block;
            text-align: center;
            margin-top: 15px;
        }

        .manage-subscription-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 480px) {
            .premium-badge {
                top: 10px;
                right: 10px;
                font-size: 0.7rem;
                padding: 4px 8px;
            }

            .premium-title {
                font-size: 1.2rem;
                padding-right: 60px;
            }

            .journey-title {
                font-size: 1rem;
            }

            .journey-duration {
                font-size: 0.75rem;
            }

            .journey-status {
                font-size: 0.7rem;
                padding: 2px 6px;
            }

            .progress-text {
                font-size: 0.8rem;
            }

            .journey-btn {
                font-size: 0.85rem;
            }

            .journey-modal-title {
                font-size: 1.2rem;
            }

            .task-title {
                font-size: 1rem;
            }

            .task-description {
                font-size: 0.9rem;
            }

            .filter-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Onboarding Section -->
    <section id="onboarding" class="section active">
        <div class="onboarding-container">
            <!-- Slide 1 -->
            <div class="onboarding-slide active" id="slide1">
                <div class="onboarding-emoji">ðŸŒ±</div>
                <h1 class="onboarding-title">Benvenuto in Vivi Consapevolmente</h1>
                <p class="onboarding-text">Il tuo compagno quotidiano per coltivare la consapevolezza, ridurre lo stress e vivere una vita piÃ¹ equilibrata.</p>

                <button class="onboarding-btn" id="next-btn1">Avanti</button>
            </div>

            <!-- Slide 2 -->
            <div class="onboarding-slide" id="slide2">
                <div class="onboarding-emoji">ðŸ§˜</div>
                <h1 class="onboarding-title">Meditazioni Guidate</h1>
                <p class="onboarding-text">Esplora la nostra libreria di meditazioni guidate per ogni momento della tua giornata. Dal risveglio consapevole al rilassamento serale.</p>

                <button class="onboarding-btn" id="next-btn2">Avanti</button>
            </div>

            <!-- Slide 3 -->
            <div class="onboarding-slide" id="slide3">
                <div class="onboarding-emoji">ðŸŒˆ</div>
                <h1 class="onboarding-title">Percorsi di Crescita</h1>
                <p class="onboarding-text">Segui i nostri percorsi strutturati per sviluppare nuove abitudini, gestire l'ansia e migliorare la concentrazione passo dopo passo.</p>

                <button class="onboarding-btn" id="next-btn3">Avanti</button>
            </div>

            <!-- Slide 4 - Feature Tour with terms acceptance -->
            <div class="onboarding-slide" id="slide4">
                <div class="onboarding-emoji">ðŸ“±</div>
                <h1 class="onboarding-title">Scopri le FunzionalitÃ </h1>
                <p class="onboarding-text">Esplora meditazioni guidate, monitora il tuo umore, segui percorsi di crescita e molto altro, tutto in un unico posto.</p>

                <div class="terms-container">
                    <div class="terms-checkbox">
                        <input type="checkbox" id="terms-checkbox">
                        <label for="terms-checkbox">Accetto i Termini di Servizio e la Privacy Policy</label>
                    </div>
                    <div class="terms-links">
                        <a href="#" id="terms-link">Termini di Servizio</a>
                        <a href="#" id="privacy-link">Privacy Policy</a>
                    </div>
                </div>

                <button class="onboarding-btn" id="next-btn4" disabled>Inizia a Esplorare</button>
            </div>
        </div>
    </section>

    <!-- Calming background elements - Spread out -->
    <div class="calm-element floating" style="top: 5%; left: 5%;">
        <div class="calm-leaf">ðŸƒ</div>
    </div>
    <div class="calm-element floating" style="top: 15%; right: 10%; animation-delay: 0.5s;">
        <div class="calm-leaf">ðŸŒ¸</div>
    </div>
    <div class="calm-element pulse" style="top: 40%; left: 15%;">
        <div class="calm-leaf">ðŸŒ¿</div>
    </div>
    <div class="calm-element floating" style="bottom: 25%; right: 5%; animation-delay: 1s;">
        <div class="calm-leaf">ðŸŒ±</div>
    </div>
    <div class="calm-element floating" style="top: 25%; left: 80%; animation-delay: 1.5s;">
        <div class="calm-leaf">ðŸŒ¼</div>
    </div>
    <div class="calm-element floating" style="bottom: 15%; left: 20%; animation-delay: 2s;">
        <div class="calm-leaf">ðŸ€</div>
    </div>
    <div class="calm-element pulse" style="top: 70%; left: 30%;">
        <div class="calm-leaf">ðŸ¦‹</div>
    </div>

    <!-- Theme Toggle Button -->
    <div class="theme-toggle" id="theme-toggle">
        <i class="fas fa-moon"></i>
    </div>

    <div class="container">
        <!-- Home Section -->
        <section id="home" class="section">
            <div class="header">
                <h1 id="welcome-header">Bentornato! ðŸ˜Š</h1>
                <p>Prenditi un momento per te oggi</p>
            </div>

            <!-- Streak Counter - Updated to be thinner -->
            <div class="streak-card">
                <div class="streak-number" id="streak-counter">0</div>
                <div class="streak-label">Giorni consecutivi di crescita ðŸ”¥</div>
                <p style="margin-top: 5px; font-size: 0.9rem; opacity: 0.8;">Continua cosÃ¬! Ogni giorno conta.</p>
            </div>

            <div class="daily-card">
                <img id="daily-image" src="https://images.unsplash.com/photo-1505142468610-359e7d316be0?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=400&w=800&ixlib=rb-1.2.1&q=80" alt="Immagine del giorno">
                <div class="daily-card-overlay">
                    <h3><i class="fas fa-quote-left"></i> Pensiero del Giorno</h3>
                    <p id="daily-quote">"Il momento presente Ã¨ l'unico momento disponibile." - Thich Nhat Hanh</p>
                </div>
            </div>

            <!-- Daily Intention - Updated to match goal card style -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-seedling"></i>
                    <span>Intenzione Giornaliera</span>
                </div>
                <div class="intention-container" id="intention-container">
                    <!-- Dynamic content -->
                </div>
            </div>

            <!-- Daily Goal -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-bullseye"></i>
                    <span>Obiettivo Giornaliero</span>
                </div>
                <div class="goal-container" id="daily-goal-container">
                    <!-- Dynamic content -->
                </div>
            </div>

            <!-- Daily inspiration card -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-lightbulb"></i>
                    <span>Consiglio del Giorno</span>
                </div>
                <p>Ogni volta che ricevi un promemoria benessere, fermati e nota tre cose intorno a te. Questo semplice esercizio ti aiuta a radicarti nel presente.</p>
            </div>
        </section>

        <!-- Meditations Section -->
        <section id="meditations" class="section">
            <div class="header">
                <h1><i class="fas fa-spa"></i> Meditazioni Guidate</h1>
                <p>Scegli tra le nostre sessioni di meditazione per ogni esigenza</p>
            </div>

            <div class="meditation-filters">
                <button class="filter-btn active" data-filter="mattina">
                    <i class="fas fa-sun"></i> Mattina
                </button>
                <button class="filter-btn" data-filter="sera">
                    <i class="fas fa-moon"></i> Sera
                </button>
                <button class="filter-btn" data-filter="ansia">
                    <i class="fas fa-wind"></i> Ansia
                </button>
                <button class="filter-btn" data-filter="sonno">
                    <i class="fas fa-bed"></i> Sonno
                </button>
                <button class="filter-btn" data-filter="lavoro">
                    <i class="fas fa-briefcase"></i> Lavoro
                </button>
            </div>

            <div class="meditation-list">
                <div class="meditation-item" data-id="1" data-title="Risveglio Consapevole" data-duration="10 min" data-tags="mattina">
                    <div class="meditation-icon"><i class="fas fa-sun"></i></div>
                    <div class="meditation-info">
                        <div class="meditation-title">Risveglio Consapevole</div>
                        <div class="meditation-desc">Inizia la tua giornata con energia e presenza mentale</div>
                    </div>
                    <button class="download-btn" data-id="1">
                        <i class="fas fa-download"></i>
                    </button>
                </div>

                <div class="meditation-item" data-id="2" data-title="Respirazione Profonda" data-duration="5 min" data-tags="ansia">
                    <div class="meditation-icon"><i class="fas fa-wind"></i></div>
                    <div class="meditation-info">
                        <div class="meditation-title">Respirazione Profonda</div>
                        <div class="meditation-desc">Riduci lo stress e l'ansia in pochi minuti</div>
                    </div>
                    <button class="download-btn" data-id="2">
                        <i class="fas fa-download"></i>
                    </button>
                </div>

                <div class="meditation-item" data-id="3" data-title="Rilassamento Serale" data-duration="15 min" data-tags="sera,sonno">
                    <div class="meditation-icon"><i class="fas fa-moon"></i></div>
                    <div class="meditation-info">
                        <div class="meditation-title">Rilassamento Serale</div>
                        <div class="meditation-desc">Prepara il corpo e la mente per un sonno ristoratore</div>
                    </div>
                    <button class="download-btn" data-id="3">
                        <i class="fas fa-download"></i>
                    </button>
                </div>

                <div class="meditation-item" data-id="4" data-title="Concentrazione Assoluta" data-duration="12 min" data-tags="mattina,lavoro">
                    <div class="meditation-icon"><i class="fas fa-bullseye"></i></div>
                    <div class="meditation-info">
                        <div class="meditation-title">Concentrazione Assoluta</div>
                        <div class="meditation-desc">Migliora la tua attenzione e produttivitÃ </div>
                    </div>
                    <button class="download-btn" data-id="4">
                        <i class="fas fa-download"></i>
                    </button>
                </div>

                <div class="meditation-item" data-id="5" data-title="Auto-compassione" data-duration="8 min" data-tags="ansia">
                    <div class="meditation-icon"><i class="fas fa-heart"></i></div>
                    <div class="meditation-info">
                        <div class="meditation-title">Auto-compassione</div>
                        <div class="meditation-desc">Coltiva gentilezza e accettazione verso te stesso</div>
                    </div>
                    <button class="download-btn" data-id="5">
                        <i class="fas fa-download"></i>
                    </button>
                </div>

                <div class="meditation-item" data-id="6" data-title="Focus al Lavoro" data-duration="8 min" data-tags="lavoro">
                    <div class="meditation-icon"><i class="fas fa-briefcase"></i></div>
                    <div class="meditation-info">
                        <div class="meditation-title">Focus al Lavoro</div>
                        <div class="meditation-desc">Ritrova la concentrazione durante la giornata lavorativa</div>
                    </div>
                    <button class="download-btn" data-id="6">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- Health Section -->
        <section id="health" class="section">
            <div class="header">
                <h1><i class="fas fa-heartbeat"></i> Salute & Benessere</h1>
                <p>Prenditi cura del tuo benessere fisico e mentale</p>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-smile"></i>
                    <span>Check-in Umore</span>
                </div>
                <div class="mood-tracker">
                    <button class="mood-btn" data-mood="devastato">ðŸ˜­</button>
                    <button class="mood-btn" data-mood="stressato">ðŸ˜©</button>
                    <button class="mood-btn" data-mood="arrabbiato">ðŸ˜ </button>
                    <button class="mood-btn" data-mood="triste">ðŸ˜”</button>
                    <button class="mood-btn" data-mood="neutro">ðŸ˜</button>
                    <button class="mood-btn" data-mood="calmo">ðŸ˜Œ</button>
                    <button class="mood-btn" data-mood="contento">ðŸ™‚</button>
                    <button class="mood-btn" data-mood="felice">ðŸ˜Š</button>
                    <button class="mood-btn" data-mood="entusiasta">ðŸ˜„</button>
                    <button class="mood-btn" data-mood="amore">ðŸ˜</button>
                </div>
                <div class="mood-status">
                    <i class="fas fa-info-circle"></i> Ãˆ ora per il tuo check-in del pomeriggio!
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-star"></i>
                    <span>Diario della Gratitudine</span>
                </div>
                <form class="gratitude-form" id="gratitude-form">
                    <input type="text" class="gratitude-input" placeholder="Cosa ti rende grato oggi? (Es. Il sole che splende)">
                    <input type="text" class="gratitude-input" placeholder="Un'altra cosa per cui sei grato">
                    <input type="text" class="gratitude-input" placeholder="E un'altra ancora...">
                    <button type="submit" class="gratitude-btn" id="gratitude-btn">
                        <i class="fas fa-book"></i> Salva nel Diario
                    </button>
                </form>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-bell"></i>
                    <span>Promemoria Benessere</span>
                </div>
                <div class="reminder-settings">
                    <div class="reminder-item">
                        <div class="reminder-header">
                            <span>ðŸ’¨</span>
                            <span>Respiro Consapevole</span>
                            <label class="toggle-switch">
                                <input type="checkbox" class="reminder-toggle" data-type="breathing" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="reminder-controls">
                            <div class="reminder-control">
                                <label>Intervallo (min)</label>
                                <input type="number" class="reminder-interval" data-type="breathing" value="60" min="15" max="120">
                            </div>
                            <div class="reminder-control">
                                <label>Suono</label>
                                <select class="reminder-sound" data-type="breathing">
                                    <option value="bells">Campane</option>
                                    <option value="nature">Natura</option>
                                    <option value="piano">Pianoforte</option>
                                </select>
                            </div>
                        </div>
                        <div class="time-range">
                            <input type="time" class="time-input" value="08:00">
                            <span>-</span>
                            <input type="time" class="time-input" value="20:00">
                        </div>
                    </div>

                    <div class="reminder-item">
                        <div class="reminder-header">
                            <span>ðŸ’§</span>
                            <span>Ricorda di Bere</span>
                            <label class="toggle-switch">
                                <input type="checkbox" class="reminder-toggle" data-type="water" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="reminder-controls">
                            <div class="reminder-control">
                                <label>Intervallo (min)</label>
                                <input type="number" class="reminder-interval" data-type="water" value="30" min="15" max="120">
                            </div>
                            <div class="reminder-control">
                                <label>Suono</label>
                                <select class="reminder-sound" data-type="water">
                                    <option value="bells">Campane</option>
                                    <option value="nature">Natura</option>
                                    <option value="piano">Pianoforte</option>
                                </select>
                            </div>
                        </div>
                        <div class="time-range">
                            <input type="time" class="time-input" value="07:00">
                            <span>-</span>
                            <input type="time" class="time-input" value="22:00">
                        </div>
                    </div>

                    <div class="reminder-item">
                        <div class="reminder-header">
                            <span>ðŸ§</span>
                            <span>Controllo Postura</span>
                            <label class="toggle-switch">
                                <input type="checkbox" class="reminder-toggle" data-type="posture" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="reminder-controls">
                            <div class="reminder-control">
                                <label>Intervallo (min)</label>
                                <input type="number" class="reminder-interval" data-type="posture" value="45" min="15" max="120">
                            </div>
                            <div class="reminder-control">
                                <label>Suono</label>
                                <select class="reminder-sound" data-type="posture">
                                    <option value="bells">Campane</option>
                                    <option value="nature">Natura</option>
                                    <option value="piano">Pianoforte</option>
                                </select>
                            </div>
                        </div>
                        <div class="time-range">
                            <input type="time" class="time-input" value="09:00">
                            <span>-</span>
                            <input type="time" class="time-input" value="21:00">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Journeys Section -->
        <section id="journeys" class="section">
            <div class="header">
                <h1><i class="fas fa-route"></i> Percorsi di Crescita</h1>
                <p>Segui un percorso strutturato per raggiungere i tuoi obiettivi</p>
            </div>

            <div class="journey-list">
                <div class="journey-item journey-1">
                    <div class="journey-header">
                        <div>
                            <div class="journey-title">7 giorni per ridurre l'ansia</div>
                            <div class="journey-duration">7 giorni â€¢ 10 min/giorno</div>
                        </div>
                        <div class="journey-status" id="journey-1-status">Inizia</div>
                    </div>
                    <div class="journey-body">
                        <div class="journey-progress">
                            <div class="progress-text">
                                <span>Progresso</span>
                                <span id="journey-1-progress">0/7 giorni</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="journey-1-fill" style="width: 0%;"></div>
                            </div>
                        </div>
                        <button class="journey-btn" id="journey-1-btn">
                            <i class="fas fa-play"></i> Inizia il Percorso
                        </button>
                    </div>
                </div>

                <div class="journey-item journey-2">
                    <div class="journey-header">
                        <div>
                            <div class="journey-title">10 giorni per migliorare la concentrazione</div>
                            <div class="journey-duration">10 giorni â€¢ 15 min/giorno</div>
                        </div>
                        <div class="journey-status" id="journey-2-status">Bloccato</div>
                    </div>
                    <div class="journey-body">
                        <div class="journey-progress">
                            <div class="progress-text">
                                <span>Progresso</span>
                                <span id="journey-2-progress">0/10 giorni</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="journey-2-fill" style="width: 0%;"></div>
                            </div>
                        </div>
                        <button class="journey-btn journey-locked" id="journey-2-btn">
                            <i class="fas fa-lock"></i> Sblocca completando il primo percorso
                        </button>
                    </div>
                </div>

                <div class="journey-item journey-3">
                    <div class="journey-header">
                        <div>
                            <div class="journey-title">21 giorni per creare un'abitudine</div>
                            <div class="journey-duration">21 giorni â€¢ 5-15 min/giorno</div>
                        </div>
                        <div class="journey-status" id="journey-3-status">Bloccato</div>
                    </div>
                    <div class="journey-body">
                        <div class="journey-progress">
                            <div class="progress-text">
                                <span>Progresso</span>
                                <span id="journey-3-progress">0/21 giorni</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="journey-3-fill" style="width: 0%;"></div>
                            </div>
                        </div>
                        <button class="journey-btn journey-locked" id="journey-3-btn">
                            <i class="fas fa-lock"></i> Sblocca completando il secondo percorso
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profile" class="section">
            <div class="profile-header">
                <div class="profile-emoji" id="profile-emoji">ðŸ˜Š</div>
                <div class="profile-info">
                    <div class="profile-name" id="profile-name">Marco Rossi</div>
                    <div class="profile-welcome" id="profile-welcome">Benvenuto nella tua area personale</div>
                </div>
            </div>

            <div class="card">
                <div class="profile-item" id="history-btn">
                    <div class="profile-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="profile-text">Storico e Progressi</div>
                </div>

                <div class="profile-item" id="edit-profile-btn">
                    <div class="profile-icon">
                        <i class="fas fa-user-edit"></i>
                    </div>
                    <div class="profile-text">Modifica profilo</div>
                </div>

                <div class="profile-item" id="theme-toggle-profile">
                    <div class="profile-icon">
                        <i class="fas fa-moon"></i>
                    </div>
                    <div class="profile-text">Tema Scuro</div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="theme-toggle-input">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="profile-item" id="terms-btn">
                    <div class="profile-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="profile-text">Termini di Servizio</div>
                </div>

                <div class="profile-item" id="privacy-btn">
                    <div class="profile-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="profile-text">Privacy Policy</div>
                </div>
            </div>

            <!-- Premium Section with updated pricing -->
            <div class="premium-card">
                <div class="premium-badge">PREMIUM</div>
                <div class="premium-title">
                    <i class="fas fa-crown"></i>
                    <span>Diventa Premium</span>
                </div>
                <div class="premium-features">
                    <ul>
                        <li><i class="fas fa-unlock"></i> Meditazioni illimitate (3 in versione free)</li>
                        <li><i class="fas fa-unlock"></i> Report storico completo</li>
                        <li><i class="fas fa-unlock"></i> Statistiche avanzate</li>
                        <li><i class="fas fa-unlock"></i> Contenuti premium esclusivi</li>
                        <li><i class="fas fa-unlock"></i> Accesso a tutti i suoni rilassanti</li>
                        <li><i class="fas fa-unlock"></i> Personalizzazione avanzata</li>
                    </ul>
                </div>

                <div class="subscribe-container">
                    <div class="subscribe-option">
                        <div class="subscribe-header">
                            <div class="subscribe-name">Abbonamento Mensile</div>
                            <div class="subscribe-price">6,99â‚¬/mese</div>
                        </div>
                        <div class="price-details">
                            <span>â‰ˆ â‚¬0.23 al giorno</span>
                            <div class="price-note">escluse tasse</div>
                        </div>
                        <button class="subscribe-btn-premium" id="monthly-subscribe">Abbonati Ora</button>
                    </div>

                    <div class="subscribe-option">
                        <div class="subscribe-header">
                            <div class="subscribe-name">Abbonamento Annuale</div>
                            <div class="subscribe-price">49,99â‚¬/anno</div>
                        </div>
                        <div class="price-details">
                            <span>â‰ˆ â‚¬0.14 al giorno</span>
                            <div class="price-note">escluse tasse</div>
                        </div>
                        <div class="trial-badge">7 giorni gratis</div>
                        <button class="subscribe-btn-premium" id="annual-subscribe">Abbonati Ora</button>
                    </div>
                </div>

                <!-- Ripristina acquisti -->
                <button class="manage-subscription-btn" id="restore-purchases">
                    <i class="fas fa-redo"></i> Ripristina Acquisti
                </button>
            </div>

            <!-- Login/Logout Section -->
            <div class="card" id="login-section">
                <div class="profile-item" id="login-btn">
                    <div class="profile-icon">
                        <i class="fab fa-google"></i>
                    </div>
                    <div class="profile-text">Accedi con Google</div>
                </div>
            </div>

            <div class="card" id="logout-section" style="display: none;">
                <div class="profile-item logout-btn" id="logout-btn">
                    <div class="profile-icon">
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                    <div class="profile-text">Esci</div>
                </div>
            </div>

            <!-- Delete account button -->
            <div class="card">
                <button class="delete-account-btn" id="delete-account-btn">
                    <i class="fas fa-trash-alt"></i> Elimina il mio account
                </button>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-hands"></i>
                    <span>Supporto e Aiuto</span>
                </div>
                <p style="padding: 10px; color: var(--text-light);">Siamo qui per te. Se hai bisogno di supporto o vuoi condividere la tua esperienza, contattaci a supporto@viviconsapevolmente.it</p>
            </div>
        </section>
    </div>

    <!-- Meditation Player Modal - Simplified -->
    <div class="player-modal" id="player-modal">
        <div class="player-container">
            <div class="player-header">
                <h2 id="player-title">Meditazione del Respiro</h2>
            </div>
            <div class="player-body">
                <p id="player-description" style="text-align: center; margin-bottom: 20px; color: var(--text-light);">
                    10 minuti di calma e concentrazione
                </p>

                <!-- Progress bar -->
                <div style="margin-bottom: 20px;">
                    <div style="height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden;">
                        <div id="progress-bar" style="height: 100%; width: 0%; background: var(--primary);"></div>
                    </div>
                </div>

                <div class="player-controls">
                    <button class="player-btn" id="player-restart">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="player-btn" id="player-play">
                        <i class="fas fa-play" id="play-icon"></i>
                    </button>
                </div>
                <audio id="meditation-audio"></audio>

                <button class="player-close" id="player-close-btn">Chiudi</button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="history-modal" id="history-modal">
        <div class="history-container">
            <div class="history-header">
                <div class="history-title">Storico e Progressi</div>
                <button class="history-close" id="history-close-btn">&times;</button>
            </div>

            <div class="calendar-navigation">
                <button class="calendar-nav-btn" id="prev-month-btn">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="calendar-month" id="calendar-month">Luglio 2025</div>
                <button class="calendar-nav-btn" id="next-month-btn">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <div class="calendar-container" id="calendar">
                <!-- Calendar will be generated here -->
            </div>

            <div class="mood-bar-container">
                <div class="mood-bar-label">
                    <span>Basso</span>
                    <span>Alto</span>
                </div>
                <div class="mood-bar">
                    <div class="mood-bar-indicator" id="mood-indicator" style="left: 70%;"></div>
                </div>
                <p style="text-align: center; margin-top: 10px; color: var(--text-light);">
                    Media umore giornaliera: <span id="mood-average">3.8</span>
                </p>
            </div>

            <div class="history-section">
                <div class="history-section-title">Umore Registrato</div>
                <div class="card" id="mood-history-container">
                    <!-- Mood history will be populated here -->
                </div>
            </div>

            <div class="history-section">
                <div class="history-section-title">Diario della Gratitudine</div>
                <div class="card" id="gratitude-history-container">
                    <!-- Gratitude entries will be populated here -->
                </div>
            </div>

            <div class="history-section">
                <div class="history-section-title">Obiettivi Giornalieri</div>
                <div class="card" id="goal-history-container">
                    <!-- Goal history will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Edit Modal -->
    <div class="profile-edit-modal" id="profile-edit-modal">
        <div class="profile-edit-container">
            <h2 class="profile-edit-title">Modifica Profilo</h2>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Nome</label>
                <input type="text" class="profile-edit-input" id="profile-name-input" placeholder="Il tuo nome" style="width: 100%; padding: 12px 15px; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 1rem;">
            </div>

            <div class="gender-selection">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Genere</label>
                <div class="gender-options">
                    <div class="gender-option" data-gender="M">Maschile</div>
                    <div class="gender-option" data-gender="F">Femminile</div>
                    <div class="gender-option" data-gender="N">Neutro</div>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Emoji</label>
                <div class="emoji-picker">
                    <div class="emoji-option" data-emoji="ðŸ˜Š">ðŸ˜Š</div>
                    <div class="emoji-option" data-emoji="ðŸ˜„">ðŸ˜„</div>
                    <div class="emoji-option" data-emoji="ðŸ˜Œ">ðŸ˜Œ</div>
                    <div class="emoji-option" data-emoji="ðŸ§˜">ðŸ§˜</div>
                    <div class="emoji-option" data-emoji="ðŸŒ¿">ðŸŒ¿</div>
                    <div class="emoji-option" data-emoji="ðŸŒ¸">ðŸŒ¸</div>
                    <div class="emoji-option" data-emoji="ðŸ¦‹">ðŸ¦‹</div>
                    <div class="emoji-option" data-emoji="ðŸŒˆ">ðŸŒˆ</div>
                    <div class="emoji-option" data-emoji="ðŸŒž">ðŸŒž</div>
                    <div class="emoji-option" data-emoji="ðŸŒ™">ðŸŒ™</div>
                    <div class="emoji-option" data-emoji="ðŸƒ">ðŸƒ</div>
                    <div class="emoji-option" data-emoji="ðŸŒ¼">ðŸŒ¼</div>
                </div>
            </div>

            <div class="profile-edit-buttons">
                <button class="profile-edit-cancel" id="profile-edit-cancel">Annulla</button>
                <button class="profile-edit-save" id="profile-edit-save">Salva</button>
            </div>
        </div>
    </div>

    <!-- Journey Detail Modal -->
    <div class="journey-modal" id="journey-modal">
        <div class="journey-container" id="journey-modal-container">
            <div class="journey-modal-header">
                <div class="journey-modal-title" id="journey-modal-title">7 giorni per ridurre l'ansia</div>
                <button class="journey-close" id="journey-close-btn">&times;</button>
            </div>

            <div class="current-day">
                <span class="day-number" id="current-day-number">1</span>
                <span id="current-day-text">Giorno 1 di 7</span>
            </div>

            <div class="task-card">
                <div class="task-title">
                    <i class="fas fa-tasks"></i>
                    <span id="task-title">AttivitÃ  del giorno</span>
                </div>
                <div class="task-description" id="task-description">
                    Completa una meditazione guidata di 5 minuti concentrandoti sul respiro. Trova un luogo tranquillo e siediti comodamente.
                </div>

                <div class="task-checkbox">
                    <input type="checkbox" id="task-completed-checkbox">
                    <label for="task-completed-checkbox" class="checkbox-label">
                        <div class="checkbox-custom"></div>
                        <span>Ho completato questa attivitÃ </span>
                    </label>
                </div>

                <div class="task-completed" id="task-completed">
                    <!-- Gender specific message will be inserted here -->
                </div>
            </div>

            <div class="journey-modal-completed" id="journey-completed-message" style="display: none;">
                <i class="fas fa-trophy"></i> Percorso completato! Ottimo lavoro!
            </div>

            <div class="journey-section">
                <div class="journey-section-title">Tappe del percorso</div>
                <div class="journey-days" id="journey-days-list">
                    <!-- Days will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="login-modal" id="login-modal">
        <div class="login-container">
            <div class="login-header">
                <div class="app-logo">ðŸ§˜</div>
                <div class="app-name">Vivi Consapevolmente</div>
                <div class="app-tagline">La tua app per il benessere quotidiano</div>
            </div>
            <button class="google-login-btn" id="google-login">
                <i class="fab fa-google"></i> Accedi con Google
            </button>
            <button class="login-close" id="login-close-btn">Continua senza account</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Navigation Bar -->
    <div class="nav-bar">
        <a href="#" class="nav-item active" data-target="home">
            <div class="nav-icon"><i class="fas fa-home"></i></div>
            <div>Home</div>
        </a>
        <a href="#" class="nav-item" data-target="meditations">
            <div class="nav-icon"><i class="fas fa-spa"></i></div>
            <div>Meditazioni</div>
        </a>
        <a href="#" class="nav-item" data-target="health">
            <div class="nav-icon"><i class="fas fa-heartbeat"></i></div>
            <div>Salute</div>
        </a>
        <a href="#" class="nav-item" data-target="journeys">
            <div class="nav-icon"><i class="fas fa-route"></i></div>
            <div>Percorsi</div>
        </a>
        <a href="#" class="nav-item" data-target="profile">
            <div class="nav-icon"><i class="fas fa-user"></i></div>
            <div>Profilo</div>
        </a>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // App state
        const state = {
            onboardingCompleted: false,
            currentMeditation: null,
            moodEntries: {},
            gratitudeEntries: {},
            dailyGoals: {},
            dailyIntentions: {},
            timeWindows: [
                {id: 'morning', start: 7, end: 13.99, name: 'Mattina'},
                {id: 'afternoon', start: 14, end: 20.99, name: 'Pomeriggio'},
                {id: 'evening', start: 21, end: 23.99, name: 'Sera'}
            ],
            profile: {
                name: "Marco Rossi",
                gender: "M",
                emoji: "ðŸ˜Š"
            },
            reminders: {
                breathing: {
                    interval: 60,
                    sound: 'bells',
                    active: true,
                    from: "08:00",
                    to: "20:00"
                },
                posture: {
                    interval: 45,
                    sound: 'bells',
                    active: true,
                    from: "09:00",
                    to: "21:00"
                },
                water: {
                    interval: 30,
                    sound: 'bells',
                    active: true,
                    from: "07:00",
                    to: "22:00"
                }
            },
            currentCalendarDate: new Date(2025, 6, 1), // Luglio 2025
            isPremium: false,
            referralCode: null,
            isLoggedIn: false,
            journeys: {
                anxiety: {
                    id: 'anxiety',
                    title: '7 giorni per ridurre l\'ansia',
                    duration: 7,
                    currentDay: 1,
                    completedDays: [],
                    startDate: null,
                    unlocked: true,
                    tasks: [
                        "Completa una meditazione guidata di 5 minuti concentrandoti sul respiro",
                        "Scrivi tre cose per cui sei grato nel tuo diario della gratitudine",
                        "Fai 10 minuti di respirazione profonda in un luogo tranquillo",
                        "Identifica una situazione stressante e scrivi come potresti affrontarla diversamente",
                        "Pratica 5 minuti di stretching consapevole",
                        "Dedica 10 minuti a un'attivitÃ  che ti rilassa senza distrazioni",
                        "Rifletti sul percorso e sui tuoi progressi"
                    ]
                },
                focus: {
                    id: 'focus',
                    title: '10 giorni per migliorare la concentrazione',
                    duration: 10,
                    currentDay: 1,
                    completedDays: [],
                    startDate: null,
                    unlocked: false,
                    tasks: [
                        "Medita per 10 minuti concentrandoti su un singolo oggetto",
                        "Organizza il tuo spazio di lavoro eliminando le distrazioni",
                        "Pratica la tecnica del pomodoro (25 minuti lavoro, 5 minuti pausa)",
                        "Completa un esercizio di concentrazione di 5 minuti",
                        "Dedica 15 minuti a leggere senza distrazioni",
                        "Crea una lista di prioritÃ  per la tua giornata",
                        "Pratica 10 minuti di respirazione focalizzata",
                        "Completa un puzzle o un gioco che richiede concentrazione",
                        "Medita camminando per 10 minuti concentrandoti sui passi",
                        "Rifletti sui miglioramenti nella tua concentrazione"
                    ]
                },
                habit: {
                    id: 'habit',
                    title: '21 giorni per creare un\'abitudine',
                    duration: 21,
                    currentDay: 1,
                    completedDays: [],
                    startDate: null,
                    unlocked: false,
                    tasks: [
                        "Definisci l'abitudine che vuoi creare e perchÃ© Ã¨ importante",
                        "Identifica un momento specifico della giornata per praticarla",
                        "Prepara l'ambiente per facilitare la nuova abitudine",
                        "Pratica l'abitudine per almeno 5 minuti",
                        "Associa la nuova abitudine a un'abitudine esistente",
                        "Tieni traccia dei tuoi progressi",
                        "Celebra i piccoli successi",
                        "Rifletti sulle difficoltÃ  e su come superarle",
                        "Condividi il tuo obiettivo con qualcuno",
                        "Pratica l'abitudine per 10 minuti",
                        "Visualizza te stesso che pratichi con successo l'abitudine",
                        "Prepara un piano per gli ostacoli previsti",
                        "Pratica l'abitudine in un contesto diverso",
                        "Trova un partner di responsabilitÃ ",
                        "Rifletti sui benefici che stai sperimentando",
                        "Aumenta la durata a 15 minuti",
                        "Pratica anche quando non ne hai voglia",
                        "Ripensa ai tuoi progressi e aggiusta se necessario",
                        "Celebra la seconda settimana di successo",
                        "Pratica in condizioni non ideali",
                        "Rifletti sul percorso e preparati a continuare"
                    ]
                }
            },
            darkTheme: false,
            growthStreak: 0,
            lastActivityDate: null,
            downloadedMeditations: {},
            meditationHistory: {},
            lastAccessDate: null,
            streakUpdatedToday: false
        };

        // Percorsi dei file audio
        const meditationAudios = {
            1: 'https://assets.mixkit.co/sfx/preview/mixkit-meditation-bell-552.mp3',
            2: 'https://assets.mixkit.co/sfx/preview/mixkit-meditation-bell-552.mp3',
            3: 'https://assets.mixkit.co/sfx/preview/mixkit-meditation-bell-552.mp3',
            4: 'https://assets.mixkit.co/sfx/preview/mixkit-meditation-bell-552.mp3',
            5: 'https://assets.mixkit.co/sfx/preview/mixkit-meditation-bell-552.mp3',
            6: 'https://assets.mixkit.co/sfx/preview/mixkit-meditation-bell-552.mp3'
        };

        const soundFiles = {
            bells: 'https://assets.mixkit.co/sfx/preview/mixkit-meditation-bell-552.mp3',
            nature: 'https://assets.mixkit.co/sfx/preview/mixkit-meditation-bell-552.mp3',
            piano: 'https://assets.mixkit.co/sfx/preview/mixkit-meditation-bell-552.mp3'
        };

        // Immagini e citazioni casuali
        const dailyInspiration = [
            {
                image: "https://images.unsplash.com/photo-1505142468610-359e7d316be0?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=400&w=800&ixlib=rb-1.2.1&q=80",
                quote: '"La pace viene da dentro. Non cercarla fuori." - Buddha'
            },
            {
                image: "https://images.unsplash.com/photo-1506126613408-eca07ce68773?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=400&w=800&ixlib=rb-1.2.1&q=80",
                quote: '"Il momento presente Ã¨ l\'unico momento disponibile." - Thich Nhat Hanh'
            },
            {
                image: "https://images.unsplash.com/photo-1513364776144-60967b0f800f?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=400&w=800&ixlib=rb-1.2.1&q=80",
                quote: '"Respira. Lascia andare. E ricorda che questo momento Ã¨ l\'unico che sai per certo di avere." - Oprah Winfrey'
            },
            {
                image: "https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=400&w=800&ixlib=rb-1.2.1&q=80",
                quote: '"La meditazione non Ã¨ fuga dalla realtÃ . Ãˆ un incontro sereno con la realtÃ ." - Thich Nhat Hanh'
            },
            {
                image: "https://images.unsplash.com/photo-1497250681960-ef046c08a56e?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=400&w=800&ixlib=rb-1.2.1&q=80",
                quote: '"La natura non ha fretta, eppure tutto si realizza." - Lao Tzu'
            }
        ];

        // DOM Elements
        const sections = document.querySelectorAll('.section');
        const navItems = document.querySelectorAll('.nav-item');
        const moodButtons = document.querySelectorAll('.mood-btn');
        const meditationItems = document.querySelectorAll('.meditation-item');
        const playerModal = document.getElementById('player-modal');
        const historyModal = document.getElementById('history-modal');
        const profileEditModal = document.getElementById('profile-edit-modal');
        const loginModal = document.getElementById('login-modal');
        const journeyModal = document.getElementById('journey-modal');
        const audioPlayer = document.getElementById('meditation-audio');
        const playBtn = document.getElementById('player-play');
        const playIcon = document.getElementById('play-icon');
        const restartBtn = document.getElementById('player-restart');
        const toast = document.getElementById('toast');
        const historyBtn = document.getElementById('history-btn');
        const historyCloseBtn = document.getElementById('history-close-btn');
        const loginBtn = document.getElementById('login-btn');
        const loginCloseBtn = document.getElementById('login-close-btn');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const moodHistoryContainer = document.getElementById('mood-history-container');
        const gratitudeHistoryContainer = document.getElementById('gratitude-history-container');
        const goalHistoryContainer = document.getElementById('goal-history-container');
        const moodIndicator = document.getElementById('mood-indicator');
        const moodAverage = document.getElementById('mood-average');
        const progressBar = document.getElementById('progress-bar');
        const dailyGoalContainer = document.getElementById('daily-goal-container');
        const intentionContainer = document.getElementById('intention-container');
        const monthlySubscribeBtn = document.getElementById('monthly-subscribe');
        const annualSubscribeBtn = document.getElementById('annual-subscribe');
        const googleLoginBtn = document.getElementById('google-login');
        const journeyCloseBtn = document.getElementById('journey-close-btn');
        const journeyModalContainer = document.getElementById('journey-modal-container');
        const journeyModalTitle = document.getElementById('journey-modal-title');
        const currentDayNumber = document.getElementById('current-day-number');
        const currentDayText = document.getElementById('current-day-text');
        const taskTitle = document.getElementById('task-title');
        const taskDescription = document.getElementById('task-description');
        const taskCompleted = document.getElementById('task-completed');
        const taskCheckbox = document.getElementById('task-completed-checkbox');
        const journeyDaysList = document.getElementById('journey-days-list');
        const journey1Btn = document.getElementById('journey-1-btn');
        const journey2Btn = document.getElementById('journey-2-btn');
        const journey3Btn = document.getElementById('journey-3-btn');
        const dailyImage = document.getElementById('daily-image');
        const dailyQuote = document.getElementById('daily-quote');
        const gratitudeForm = document.getElementById('gratitude-form');
        const gratitudeInputs = document.querySelectorAll('.gratitude-input');
        const gratitudeBtn = document.getElementById('gratitude-btn');
        const journeyCompletedMessage = document.getElementById('journey-completed-message');
        const profileEditCancel = document.getElementById('profile-edit-cancel');
        const profileEditSave = document.getElementById('profile-edit-save');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const nextBtn1 = document.getElementById('next-btn1');
        const nextBtn2 = document.getElementById('next-btn2');
        const nextBtn3 = document.getElementById('next-btn3');
        const nextBtn4 = document.getElementById('next-btn4');
        const logoutBtn = document.getElementById('logout-btn');
        const logoutSection = document.getElementById('logout-section');
        const loginSection = document.getElementById('login-section');
        const termsBtn = document.getElementById('terms-btn');
        const privacyBtn = document.getElementById('privacy-btn');
        const restorePurchasesBtn = document.getElementById('restore-purchases');
        const themeToggle = document.getElementById('theme-toggle');
        const themeToggleInput = document.getElementById('theme-toggle-input');
        const themeToggleProfile = document.getElementById('theme-toggle-profile');
        const streakCounter = document.getElementById('streak-counter');
        const downloadButtons = document.querySelectorAll('.download-btn');
        const genderOptions = document.querySelectorAll('.gender-option');
        const deleteAccountBtn = document.getElementById('delete-account-btn');
        const termsCheckbox = document.getElementById('terms-checkbox');
        const termsLink = document.getElementById('terms-link');
        const privacyLink = document.getElementById('privacy-link');

        // Funzione per ottenere la data locale
        function getLocalDateString(date = new Date()) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Carica dati salvati da localStorage
        function loadSavedData() {
            const savedOnboarding = localStorage.getItem('onboardingCompleted');
            if (savedOnboarding) {
                state.onboardingCompleted = JSON.parse(savedOnboarding);
            }

            const savedProfile = localStorage.getItem('userProfile');
            if (savedProfile) {
                state.profile = JSON.parse(savedProfile);
            }

            const savedMoodEntries = localStorage.getItem('moodEntries');
            if (savedMoodEntries) {
                state.moodEntries = JSON.parse(savedMoodEntries);
            }

            const savedGratitudeEntries = localStorage.getItem('gratitudeEntries');
            if (savedGratitudeEntries) {
                state.gratitudeEntries = JSON.parse(savedGratitudeEntries);
            }

            const savedReminders = localStorage.getItem('reminders');
            if (savedReminders) {
                state.reminders = JSON.parse(savedReminders);
            }

            const savedDailyGoals = localStorage.getItem('dailyGoals');
            if (savedDailyGoals) {
                state.dailyGoals = JSON.parse(savedDailyGoals);
            }

            const savedDailyIntentions = localStorage.getItem('dailyIntentions');
            if (savedDailyIntentions) {
                state.dailyIntentions = JSON.parse(savedDailyIntentions);
            }

            const savedPremium = localStorage.getItem('isPremium');
            if (savedPremium) {
                state.isPremium = JSON.parse(savedPremium);
            }

            const savedReferralCode = localStorage.getItem('referralCode');
            if (savedReferralCode) {
                state.referralCode = savedReferralCode;
            }

            const savedLogin = localStorage.getItem('isLoggedIn');
            if (savedLogin) {
                state.isLoggedIn = JSON.parse(savedLogin);
            }

            const savedJourneys = localStorage.getItem('journeys');
            if (savedJourneys) {
                state.journeys = JSON.parse(savedJourneys);
            }

            const savedDarkTheme = localStorage.getItem('darkTheme');
            if (savedDarkTheme) {
                state.darkTheme = JSON.parse(savedDarkTheme);
            }

            const savedStreak = localStorage.getItem('growthStreak');
            if (savedStreak) {
                state.growthStreak = JSON.parse(savedStreak);
            }

            const savedLastActivity = localStorage.getItem('lastActivityDate');
            if (savedLastActivity) {
                state.lastActivityDate = savedLastActivity;
            }

            const savedDownloads = localStorage.getItem('downloadedMeditations');
            if (savedDownloads) {
                state.downloadedMeditations = JSON.parse(savedDownloads);
            }

            const savedMeditationHistory = localStorage.getItem('meditationHistory');
            if (savedMeditationHistory) {
                state.meditationHistory = JSON.parse(savedMeditationHistory);
            }

            const savedLastAccess = localStorage.getItem('lastAccessDate');
            if (savedLastAccess) {
                state.lastAccessDate = savedLastAccess;
            }

            const savedStreakUpdated = localStorage.getItem('streakUpdatedToday');
            if (savedStreakUpdated) {
                state.streakUpdatedToday = JSON.parse(savedStreakUpdated);
            }
        }

        // Salva dati in localStorage
        function saveData() {
            localStorage.setItem('onboardingCompleted', JSON.stringify(state.onboardingCompleted));
            localStorage.setItem('userProfile', JSON.stringify(state.profile));
            localStorage.setItem('moodEntries', JSON.stringify(state.moodEntries));
            localStorage.setItem('gratitudeEntries', JSON.stringify(state.gratitudeEntries));
            localStorage.setItem('reminders', JSON.stringify(state.reminders));
            localStorage.setItem('dailyGoals', JSON.stringify(state.dailyGoals));
            localStorage.setItem('dailyIntentions', JSON.stringify(state.dailyIntentions));
            localStorage.setItem('isPremium', JSON.stringify(state.isPremium));
            localStorage.setItem('referralCode', state.referralCode || '');
            localStorage.setItem('isLoggedIn', JSON.stringify(state.isLoggedIn));
            localStorage.setItem('journeys', JSON.stringify(state.journeys));
            localStorage.setItem('darkTheme', JSON.stringify(state.darkTheme));
            localStorage.setItem('growthStreak', JSON.stringify(state.growthStreak));
            localStorage.setItem('lastActivityDate', state.lastActivityDate || '');
            localStorage.setItem('downloadedMeditations', JSON.stringify(state.downloadedMeditations));
            localStorage.setItem('meditationHistory', JSON.stringify(state.meditationHistory));
            localStorage.setItem('lastAccessDate', state.lastAccessDate || '');
            localStorage.setItem('streakUpdatedToday', JSON.stringify(state.streakUpdatedToday));
        }

        // Funzione per aggiornare il messaggio di benvenuto in base al genere
        function updateWelcomeMessage() {
            let welcomeText = "";

            switch(state.profile.gender) {
                case "M":
                    welcomeText = "Bentornato!";
                    break;
                case "F":
                    welcomeText = "Bentornata!";
                    break;
                case "N":
                    welcomeText = "BentornatÉ™!";
                    break;
                default:
                    welcomeText = "Bentornato/a!";
            }

            document.getElementById('welcome-header').textContent = welcomeText + " " + (state.profile.emoji || 'ðŸ˜Š');

            const welcomeElement = document.querySelector('.profile-welcome');
            let welcomeProfileText = "";

            switch(state.profile.gender) {
                case "M":
                    welcomeProfileText = "Benvenuto nella tua area personale";
                    break;
                case "F":
                    welcomeProfileText = "Benvenuta nella tua area personale";
                    break;
                case "N":
                    welcomeProfileText = "BenvenutÉ™ nella tua area personale";
                    break;
                default:
                    welcomeProfileText = "Benvenuto/a nella tua area personale";
            }

            if (welcomeElement) {
                welcomeElement.textContent = welcomeProfileText;
            }
        }

        // Initialize UI
        function initUI() {
            document.querySelector('.profile-name').textContent = state.profile.name;
            document.querySelector('.profile-emoji').textContent = state.profile.emoji;
            updateWelcomeMessage();
            renderDailyGoal();
            renderDailyIntention();
            updateJourneysDisplay();
            updateMoodStatusMessage();
            updateStreakCounter();
            updateTheme();

            // Set random daily inspiration
            const randomInspiration = dailyInspiration[Math.floor(Math.random() * dailyInspiration.length)];
            dailyImage.src = randomInspiration.image;
            dailyQuote.textContent = randomInspiration.quote;

            // Initialize reminder settings
            document.querySelectorAll('.reminder-interval').forEach(input => {
                const type = input.dataset.type;
                input.value = state.reminders[type].interval;
            });

            document.querySelectorAll('.reminder-sound').forEach(select => {
                const type = select.dataset.type;
                select.value = state.reminders[type].sound;
            });

            // Initialize time inputs
            document.querySelectorAll('.time-input').forEach(input => {
                const type = input.closest('.reminder-item').querySelector('.reminder-toggle').dataset.type;
                const index = Array.from(input.closest('.time-range').querySelectorAll('.time-input')).indexOf(input);
                input.value = index === 0 ? state.reminders[type].from : state.reminders[type].to;
            });

            // Initialize reminder toggles
            document.querySelectorAll('.reminder-toggle').forEach(toggle => {
                const type = toggle.dataset.type;
                toggle.checked = state.reminders[type].active;
            });

            // Controlla se il diario della gratitudine Ã¨ giÃ  stato compilato oggi
            checkGratitudeLock();

            // Aggiorna stato login
            updateLoginState();

            // Aggiorna download buttons
            updateDownloadButtons();
        }

        // Aggiorna stato login/logout
        function updateLoginState() {
            if (state.isLoggedIn) {
                loginSection.style.display = 'none';
                logoutSection.style.display = 'block';
            } else {
                loginSection.style.display = 'block';
                logoutSection.style.display = 'none';
            }
        }

        // Aggiorna pulsanti download
        function updateDownloadButtons() {
            downloadButtons.forEach(btn => {
                const meditationId = btn.dataset.id;
                if (state.downloadedMeditations[meditationId]) {
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    btn.disabled = true;
                } else {
                    btn.innerHTML = '<i class="fas fa-download"></i>';
                    btn.disabled = false;
                }
            });
        }

        // Funzione per visualizzare l'obiettivo giornaliero
        function renderDailyGoal() {
            const today = getLocalDateString();
            const todayGoal = state.dailyGoals[today];

            // Se non c'Ã¨ un obiettivo per oggi
            if (!todayGoal) {
                dailyGoalContainer.innerHTML = `
                    <div class="goal-input-container">
                        <input type="text" class="goal-input" id="goal-input" placeholder="Cosa vuoi realizzare oggi?" required>
                        <button class="goal-btn" id="set-goal-btn"><i class="fas fa-plus"></i> Imposta</button>
                    </div>
                    <p style="color: var(--text-light); font-size: 0.9rem; margin-top: 5px;">
                        Inserisci un obiettivo realistico che vuoi portare a termine entro oggi.
                    </p>
                `;

                document.getElementById('set-goal-btn').addEventListener('click', setDailyGoal);
                return;
            }

            // Se c'Ã¨ un obiettivo per oggi
            dailyGoalContainer.innerHTML = `
                <div class="goal-item">
                    <div class="goal-checkbox ${todayGoal.completed ? 'checked' : ''}" id="goal-checkbox">
                        ${todayGoal.completed ? 'âœ“' : ''}
                    </div>
                    <div class="goal-text ${todayGoal.completed ? 'completed' : ''}">${todayGoal.text}</div>
                    <div class="goal-status">
                        ${todayGoal.completed ? 'Completato' : 'In corso...'}
                    </div>
                </div>
            `;

            document.getElementById('goal-checkbox').addEventListener('click', toggleGoalCompletion);
        }

        // Funzione per visualizzare l'intenzione giornaliera
        function renderDailyIntention() {
            const today = getLocalDateString();
            const todayIntention = state.dailyIntentions[today];

            // Se non c'Ã¨ un'intenzione per oggi
            if (!todayIntention) {
                intentionContainer.innerHTML = `
                    <div class="intention-input-container">
                        <input type="text" class="intention-input" id="intention-input" placeholder="Qual Ã¨ la tua intenzione per oggi?" required>
                        <button class="intention-btn" id="set-intention-btn"><i class="fas fa-feather"></i> Fissa Intenzione</button>
                    </div>
                    <p style="color: var(--text-light); font-size: 0.9rem; margin-top: 5px;">
                        Scegli un'intenzione positiva per guidare la tua giornata.
                    </p>
                `;

                document.getElementById('set-intention-btn').addEventListener('click', setDailyIntention);
                return;
            }

            // Se c'Ã¨ un'intenzione per oggi
            intentionContainer.innerHTML = `
                <div class="intention-item">
                    <div class="intention-text">"${todayIntention.text}"</div>
                    <div class="intention-date">Intenzione di oggi</div>
                </div>
            `;
        }

        // Funzione per impostare l'obiettivo giornaliero
        function setDailyGoal() {
            const input = document.getElementById('goal-input');
            const goalText = input.value.trim();

            if (!goalText) {
                showToast("Per favore inserisci un obiettivo");
                return;
            }

            const today = getLocalDateString();
            state.dailyGoals[today] = {
                text: goalText,
                completed: false,
                timestamp: new Date().getTime()
            };

            saveData();
            renderDailyGoal();
            showToast("Obiettivo impostato!");
        }

        // Funzione per impostare l'intenzione giornaliera
        function setDailyIntention() {
            const input = document.getElementById('intention-input');
            const intentionText = input.value.trim();

            if (!intentionText) {
                showToast("Per favore inserisci un'intenzione");
                return;
            }

            const today = getLocalDateString();
            state.dailyIntentions[today] = {
                text: intentionText,
                timestamp: new Date().getTime()
            };

            saveData();
            renderDailyIntention();
            showToast("Intenzione fissata!");
        }

        // Funzione per segnare l'obiettivo come completato
        function toggleGoalCompletion() {
            const today = getLocalDateString();
            const goal = state.dailyGoals[today];

            if (!goal) return;

            goal.completed = !goal.completed;
            saveData();
            renderDailyGoal();

            if (goal.completed) {
                showToast("Obiettivo completato! Bravo!");
            } else {
                showToast("Obiettivo riportato in corso");
            }
        }

        // Aggiorna visualizzazione percorsi
        function updateJourneysDisplay() {
            // Percorso 1: Ansia
            const journey1 = state.journeys.anxiety;
            const journey1Progress = document.getElementById('journey-1-progress');
            const journey1Fill = document.getElementById('journey-1-fill');
            const journey1Status = document.getElementById('journey-1-status');

            if (journey1Progress && journey1Fill && journey1Status) {
                const progressPercent = (journey1.completedDays.length / journey1.duration) * 100;

                journey1Progress.textContent = `${journey1.completedDays.length}/${journey1.duration} giorni`;
                journey1Fill.style.width = `${progressPercent}%`;

                if (journey1.completedDays.length === journey1.duration) {
                    journey1Status.textContent = 'Completato';
                    journey1Status.style.background = 'var(--success)';
                    journey1Status.style.color = 'white';
                } else if (journey1.completedDays.length > 0) {
                    journey1Status.textContent = `${journey1.completedDays.length}/${journey1.duration}`;
                    journey1Status.style.background = '';
                    journey1Status.style.color = '';
                } else {
                    journey1Status.textContent = journey1.unlocked ? 'Inizia' : 'Bloccato';
                    journey1Status.style.background = '';
                    journey1Status.style.color = '';
                }

                // Sblocca il secondo percorso se il primo Ã¨ completo
                if (journey1.completedDays.length === journey1.duration) {
                    state.journeys.focus.unlocked = true;
                }
            }

            // Percorso 2: Concentrazione
            const journey2 = state.journeys.focus;
            const journey2Progress = document.getElementById('journey-2-progress');
            const journey2Fill = document.getElementById('journey-2-fill');
            const journey2Status = document.getElementById('journey-2-status');

            if (journey2Progress && journey2Fill && journey2Status) {
                const progressPercent = (journey2.completedDays.length / journey2.duration) * 100;

                journey2Progress.textContent = `${journey2.completedDays.length}/${journey2.duration} giorni`;
                journey2Fill.style.width = `${progressPercent}%`;

                if (journey2.completedDays.length === journey2.duration) {
                    journey2Status.textContent = 'Completato';
                    journey2Status.style.background = 'var(--success)';
                    journey2Status.style.color = 'white';
                } else if (journey2.completedDays.length > 0) {
                    journey2Status.textContent = `${journey2.completedDays.length}/${journey2.duration}`;
                    journey2Status.style.background = '';
                    journey2Status.style.color = '';
                } else {
                    journey2Status.textContent = journey2.unlocked ? 'Inizia' : 'Bloccato';
                    journey2Status.style.background = '';
                    journey2Status.style.color = '';
                }

                // Sblocca il terzo percorso se il secondo Ã¨ completo
                if (journey2.completedDays.length === journey2.duration) {
                    state.journeys.habit.unlocked = true;
                }
            }

            // Percorso 3: Abitudine
            const journey3 = state.journeys.habit;
            const journey3Progress = document.getElementById('journey-3-progress');
            const journey3Fill = document.getElementById('journey-3-fill');
            const journey3Status = document.getElementById('journey-3-status');

            if (journey3Progress && journey3Fill && journey3Status) {
                const progressPercent = (journey3.completedDays.length / journey3.duration) * 100;

                journey3Progress.textContent = `${journey3.completedDays.length}/${journey3.duration} giorni`;
                journey3Fill.style.width = `${progressPercent}%`;

                if (journey3.completedDays.length === journey3.duration) {
                    journey3Status.textContent = 'Completato';
                    journey3Status.style.background = 'var(--success)';
                    journey3Status.style.color = 'white';
                } else if (journey3.completedDays.length > 0) {
                    journey3Status.textContent = `${journey3.completedDays.length}/${journey3.duration}`;
                    journey3Status.style.background = '';
                    journey3Status.style.color = '';
                } else {
                    journey3Status.textContent = journey3.unlocked ? 'Inizia' : 'Bloccato';
                    journey3Status.style.background = '';
                    journey3Status.style.color = '';
                }
            }

            // Aggiorna i pulsanti
            journey1Btn.disabled = !state.journeys.anxiety.unlocked;
            journey2Btn.disabled = !state.journeys.focus.unlocked;
            journey3Btn.disabled = !state.journeys.habit.unlocked;

            saveData();
        }

        // Funzione per aprire i dettagli del percorso
        function openJourneyDetail(journeyId) {
            const journey = state.journeys[journeyId];
            journeyModalContainer.dataset.journeyId = journeyId;

            // Aggiorna il contenuto modale
            journeyModalTitle.textContent = journey.title;

            // Aggiorna il giorno corrente
            currentDayNumber.textContent = journey.currentDay;
            currentDayText.textContent = `Giorno ${journey.currentDay} di ${journey.duration}`;

            // Aggiorna l'attivitÃ  del giorno
            taskTitle.textContent = `AttivitÃ  del giorno ${journey.currentDay}`;
            taskDescription.textContent = journey.tasks[journey.currentDay - 1];

            // Controlla se il giorno Ã¨ giÃ  completato
            const isCompleted = journey.completedDays.includes(journey.currentDay);
            taskCompleted.style.display = isCompleted ? 'block' : 'none';
            taskCheckbox.checked = isCompleted;

            // Aggiorna il messaggio di congratulazioni in base al genere
            if (isCompleted) {
                let congrats = "";
                switch(state.profile.gender) {
                    case "M":
                        congrats = "Bravo!";
                        break;
                    case "F":
                        congrats = "Brava!";
                        break;
                    default:
                        congrats = "Bravo/a!";
                }
                taskCompleted.innerHTML = `<i class="fas fa-check-circle"></i> AttivitÃ  completata! ${congrats}`;
            }

            // Mostra/nascondi messaggio completamento percorso
            if (journeyCompletedMessage) {
                journeyCompletedMessage.style.display = journey.completedDays.length === journey.duration ? 'flex' : 'none';
            }

            // Aggiorna la lista dei giorni
            journeyDaysList.innerHTML = '';
            for (let i = 1; i <= journey.duration; i++) {
                const dayItem = document.createElement('div');
                dayItem.className = `day-item ${journey.completedDays.includes(i) ? 'completed' : ''}`;

                // Blocca i giorni futuri e quelli giÃ  completati
                if (i > journey.currentDay || journey.completedDays.includes(i)) {
                    dayItem.classList.add('locked');
                }

                // Giorni futuri
                if (i > journey.currentDay) {
                    dayItem.classList.add('future');
                }

                if (i === journey.currentDay) {
                    dayItem.style.border = '2px solid var(--primary)';
                }
                dayItem.dataset.day = i;

                dayItem.innerHTML = `
                    <div class="day-check">${i}</div>
                    <div class="day-info">
                        <div class="day-title">Giorno ${i}</div>
                        <div class="day-desc">${journey.tasks[i-1].substring(0, 50)}...</div>
                    </div>
                `;

                // Abilita il click solo per il giorno corrente non completato
                if (i === journey.currentDay && !journey.completedDays.includes(i)) {
                    dayItem.addEventListener('click', function() {
                        journey.currentDay = i;
                        saveData();
                        openJourneyDetail(journeyId);
                    });
                }

                journeyDaysList.appendChild(dayItem);
            }

            // Mostra il modale
            journeyModal.classList.add('active');
        }

        // Funzione per bloccare il diario della gratitudine dopo il completamento
        function checkGratitudeLock() {
            const today = getLocalDateString();

            if (state.gratitudeEntries[today]) {
                // Disabilita gli input e il pulsante
                gratitudeInputs.forEach(input => {
                    input.value = state.gratitudeEntries[today][Array.from(gratitudeInputs).indexOf(input)] || '';
                    input.disabled = true;
                });

                gratitudeBtn.disabled = true;
                gratitudeBtn.textContent = "Completato per oggi";
                gratitudeBtn.style.background = "#e2e8f0";
                gratitudeBtn.style.color = "#64748b";
                gratitudeBtn.style.cursor = "not-allowed";
            }
        }

        // Aggiorna messaggio check-in umore
        function updateMoodStatusMessage() {
            const now = new Date();
            const currentTime = now.getHours() + now.getMinutes()/100;
            let currentWindow = null;
            for (const window of state.timeWindows) {
                if (currentTime >= window.start && currentTime <= window.end) {
                    currentWindow = window;
                    break;
                }
            }

            const moodStatus = document.querySelector('.mood-status');
            if (moodStatus) {
                if (currentWindow) {
                    moodStatus.innerHTML = `<i class="fas fa-smile"></i> Ãˆ ora per il tuo check-in ${currentWindow.name.toLowerCase()}!`;
                } else {
                    moodStatus.innerHTML = `<i class="fas fa-moon"></i> I check-in sono disponibili dalle 7:00 alle 23:59`;
                }
            }
        }

        // Aggiorna contatore streak
        function updateStreakCounter() {
            streakCounter.textContent = state.growthStreak;
        }

        // Aggiorna tema chiaro/scuro
        function updateTheme() {
            if (state.darkTheme) {
                document.body.classList.add('dark-theme');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                if (themeToggleInput) themeToggleInput.checked = true;
            } else {
                document.body.classList.remove('dark-theme');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                if (themeToggleInput) themeToggleInput.checked = false;
            }
        }

        // Inizializza RevenueCat
        async function initRevenueCat() {
            try {
                // In produzione, sostituisci con la tua API key di RevenueCat
                const REVENUECAT_API_KEY = "tu_api_key_revenuecat";

                await Purchases.configure({
                    apiKey: REVENUECAT_API_KEY,
                    appUserID: state.profile.name || "user_" + Date.now(),
                    observerMode: false
                });

                console.log("RevenueCat inizializzato con successo");

                // Controlla lo stato dell'abbonamento
                controllaAccessoPremium();
            } catch (e) {
                console.error("Errore inizializzazione RevenueCat:", e);
            }
        }

        // Funzione per mostrare e acquistare i piani
        async function mostraPianiEAcquista(packageId) {
            try {
                const offerings = await Purchases.getOfferings();

                if (offerings.current && offerings.current.availablePackages.length > 0) {
                    const pacchettoScelto = offerings.current.getPackage(packageId);

                    if (!pacchettoScelto) {
                        showToast("Pacchetto non disponibile");
                        return;
                    }

                    const { customerInfo } = await Purchases.purchasePackage(pacchettoScelto);

                    if (customerInfo.entitlements.active['premium']) {
                        state.isPremium = true;
                        saveData();
                        showToast('Grazie! La tua prova Ã¨ iniziata. Hai accesso premium!');
                    }
                } else {
                    showToast("Nessuna offerta disponibile al momento");
                }
            } catch (e) {
                if (!e.userCancelled) {
                    console.error("Errore acquisto:", e);
                    showToast("Si Ã¨ verificato un errore durante l'acquisto");
                }
            }
        }

        // Funzione per controllare lo stato dell'utente
        async function controllaAccessoPremium() {
            try {
                const customerInfo = await Purchases.getCustomerInfo();

                if (customerInfo.entitlements.active['premium']) {
                    state.isPremium = true;
                    saveData();
                    console.log("Utente premium attivo");
                } else {
                    state.isPremium = false;
                    saveData();
                    console.log("Utente non premium");
                }
            } catch (e) {
                console.error("Errore verifica accesso premium:", e);
            }
        }

        // Funzione per ripristinare gli acquisti
        async function ripristinaAcquisti() {
            try {
                showToast("Verifica acquisti in corso...");
                const customerInfo = await Purchases.restorePurchases();

                if (customerInfo.entitlements.active['premium']) {
                    state.isPremium = true;
                    saveData();
                    showToast("Acquisti ripristinati! Accesso premium attivato");
                } else {
                    showToast("Nessun acquisto precedente trovato");
                }
            } catch (e) {
                console.error("Errore ripristino acquisti:", e);
                showToast("Errore nel ripristino degli acquisti");
            }
        }

        // Carica i dati salvati e inizializza l'UI
        loadSavedData();
        initUI();

        // Initialize onboarding
        function initOnboarding() {
            const slides = document.querySelectorAll('.onboarding-slide');
            let currentSlide = 0;

            function showSlide(index) {
                slides.forEach(slide => slide.classList.remove('active'));
                slides[index].classList.add('active');
                currentSlide = index;
            }

            // Setup navigation buttons
            if (nextBtn1) {
                nextBtn1.addEventListener('click', () => showSlide(1));
            }

            if (nextBtn2) {
                nextBtn2.addEventListener('click', () => showSlide(2));
            }

            if (nextBtn3) {
                nextBtn3.addEventListener('click', () => showSlide(3));
            }

            if (nextBtn4) {
                // Enable/disable based on terms acceptance
                termsCheckbox.addEventListener('change', function() {
                    nextBtn4.disabled = !this.checked;
                });

                nextBtn4.addEventListener('click', finishOnboarding);
            }

            function finishOnboarding() {
                state.onboardingCompleted = true;
                saveData();
                document.getElementById('onboarding').style.transform = 'translateY(-100%)';

                setTimeout(() => {
                    document.getElementById('onboarding').style.display = 'none';
                    document.getElementById('home').classList.add('active');
                    document.querySelector('[data-target="home"]').classList.add('active');
                }, 500);
            }

            if (state.onboardingCompleted) {
                document.getElementById('onboarding').style.display = 'none';
                document.getElementById('home').classList.add('active');
            }
        }

        initOnboarding();

        // Inizializza RevenueCat dopo il caricamento
        initRevenueCat();

        // Navigation
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const target = this.dataset.target;

                // Update active navigation
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Show target section
                sections.forEach(section => {
                    section.classList.remove('active');
                    if (section.id === target) {
                        section.classList.add('active');
                    }
                });

                // Se siamo nella sezione Salute, inizializza il check-in
                if (target === 'health') {
                    initTimeBasedCheckin();
                    updateMoodStatusMessage();
                }
            });
        });

        // Mood tracking con finestre orarie
        if (moodButtons.length) {
            moodButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const mood = this.dataset.mood;
                    const now = new Date();
                    const currentTime = now.getHours() + now.getMinutes()/100;

                    // Trova la finestra oraria attuale
                    let currentWindow = null;
                    for (const window of state.timeWindows) {
                        if (currentTime >= window.start && currentTime <= window.end) {
                            currentWindow = window;
                            break;
                        }
                    }

                    // Controlla se siamo in una finestra oraria valida
                    if (!currentWindow) {
                        showToast("Il check-in Ã¨ disponibile solo dalle 7:00 alle 23:59");
                        return;
                    }

                    const today = getLocalDateString();

                    if (!state.moodEntries[today]) {
                        state.moodEntries[today] = [];
                    }

                    // Controlla se l'utente ha giÃ  effettuato il check-in in questa finestra oraria
                    const hasLoggedInCurrentWindow = state.moodEntries[today].some(entry =>
                        entry.window === currentWindow.id
                    );

                    if (hasLoggedInCurrentWindow) {
                        showToast(`Hai giÃ  effettuato il check-in per la ${currentWindow.name}`);
                        return;
                    }

                    // Salva il check-in con la finestra oraria
                    state.moodEntries[today].push({
                        mood,
                        window: currentWindow.id
                    });

                    showToast(`Umore registrato: ${getMoodName(mood)} ${getMoodEmoji(mood)}`);

                    // Disabilita i pulsanti per la finestra corrente
                    moodButtons.forEach(btn => btn.disabled = true);

                    // Salva i dati
                    saveData();

                    // Aggiorna lo streak solo se Ã¨ il primo check-in della giornata
                    if (!state.streakUpdatedToday) {
                        recordActivity();
                        state.streakUpdatedToday = true;
                        saveData();
                    }
                });

                // Aggiungi eventi touch per mobile
                button.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    this.click();
                }, { passive: false });
            });
        }

        // Meditation player
        if (meditationItems.length) {
            meditationItems.forEach(item => {
                item.addEventListener('click', function() {
                    const meditationId = this.dataset.id;
                    const meditationTitle = this.dataset.title;
                    const meditationDuration = this.dataset.duration;

                    state.currentMeditation = meditationId;

                    // Set meditation info in player
                    document.getElementById('player-title').textContent = meditationTitle;
                    document.getElementById('player-description').textContent =
                        `${meditationDuration} di ${this.querySelector('.meditation-desc').textContent}`;

                    // Set audio source
                    audioPlayer.src = meditationAudios[meditationId];

                    // Reset player state
                    playIcon.className = 'fas fa-play';
                    audioPlayer.pause();

                    // Reset progress bar
                    progressBar.style.width = "0%";

                    playerModal.classList.add('active');
                });

                // Aggiungi eventi touch per mobile
                item.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    this.click();
                }, { passive: false });
            });
        }

        // Download meditation
        downloadButtons.forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                const meditationId = btn.dataset.id;

                // Simulazione download
                state.downloadedMeditations[meditationId] = true;
                saveData();
                updateDownloadButtons();
                showToast("Meditazione scaricata per l'uso offline!");
            });
        });

        // Registra un'attivitÃ 
        function recordActivity() {
            const today = new Date();
            const todayStr = getLocalDateString(today);

            // Se Ã¨ la prima attivitÃ 
            if (!state.lastActivityDate) {
                state.growthStreak = 1;
                state.lastActivityDate = todayStr;
                saveData();
                updateStreakCounter();
                return;
            }

            const lastDate = new Date(state.lastActivityDate);
            const diffTime = Math.abs(today - lastDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            // Se l'ultima attivitÃ  Ã¨ stata ieri, incrementa lo streak
            if (diffDays === 1) {
                state.growthStreak++;
            }
            // Se Ã¨ passato piÃ¹ di un giorno, resetta lo streak
            else if (diffDays > 1) {
                state.growthStreak = 1;
            }

            state.lastActivityDate = todayStr;
            saveData();
            updateStreakCounter();
        }

        // Registra accesso giornaliero
        function recordAccess() {
            const today = new Date();
            const todayStr = getLocalDateString(today);

            // Se non c'Ã¨ una data di accesso
            if (!state.lastAccessDate) {
                state.lastAccessDate = todayStr;
                saveData();
                return;
            }

            const lastAccess = new Date(state.lastAccessDate);
            const diffTime = Math.abs(today - lastAccess);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            // Se l'ultimo accesso Ã¨ stato ieri, incrementa lo streak
            if (diffDays === 1) {
                state.growthStreak++;
            }
            // Se Ã¨ passato piÃ¹ di un giorno, resetta lo streak
            else if (diffDays > 1) {
                state.growthStreak = 1;
            }

            state.lastAccessDate = todayStr;
            saveData();
            updateStreakCounter();
        }

        // Aggiorna l'icona play/pause
        function updatePlayButton() {
            if (audioPlayer.paused) {
                playIcon.className = 'fas fa-play';
            } else {
                playIcon.className = 'fas fa-pause';
            }
        }

        // Player controls
        if (playBtn) {
            playBtn.addEventListener('click', function() {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                } else {
                    audioPlayer.pause();
                }
                updatePlayButton();
            });

            // Aggiungi eventi touch per mobile
            playBtn.addEventListener('touchstart', function(e) {
                e.preventDefault();
                this.click();
            }, { passive: false });
        }

        // Restart button
        if (restartBtn) {
            restartBtn.addEventListener('click', function() {
                audioPlayer.currentTime = 0;
                progressBar.style.width = "0%";

                if (audioPlayer.paused) {
                    audioPlayer.play();
                    updatePlayButton();
                }
            });

            // Aggiungi eventi touch per mobile
            restartBtn.addEventListener('touchstart', function(e) {
                e.preventDefault();
                this.click();
            }, { passive: false });
        }

        // Update progress bar
        if (audioPlayer) {
            audioPlayer.addEventListener('timeupdate', function() {
                const currentTime = audioPlayer.currentTime;
                const duration = audioPlayer.duration;

                if (duration > 0) {
                    const progressPercent = (currentTime / duration) * 100;
                    progressBar.style.width = `${progressPercent}%`;
                }
            });

            // Aggiorna il pulsante quando cambia lo stato
            audioPlayer.addEventListener('play', updatePlayButton);
            audioPlayer.addEventListener('pause', updatePlayButton);

            // Quando l'audio finisce
            audioPlayer.addEventListener('ended', function() {
                updatePlayButton();
                showToast("Meditazione completata!");

                // Salva la meditazione nella cronologia
                const today = getLocalDateString();
                if (!state.meditationHistory[today]) {
                    state.meditationHistory[today] = [];
                }

                state.meditationHistory[today].push({
                    id: state.currentMeditation,
                    title: document.getElementById('player-title').textContent,
                    duration: document.getElementById('player-description').textContent.split(' ')[0],
                    timestamp: new Date().getTime()
                });

                saveData();
            });
        }

        // Close player
        document.getElementById('player-close-btn').addEventListener('click', function() {
            playerModal.classList.remove('active');
            if (audioPlayer) {
                audioPlayer.pause();
                playIcon.className = 'fas fa-play';
            }
        });

        // Add touch event for mobile
        document.getElementById('player-close-btn').addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        // History section
        historyBtn.addEventListener('click', function() {
            historyModal.classList.add('active');
            generateCalendar();
        });

        // Add touch event for mobile
        historyBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        historyCloseBtn.addEventListener('click', function() {
            historyModal.classList.remove('active');
        });

        // Add touch event for mobile
        historyCloseBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        // Edit profile
        editProfileBtn.addEventListener('click', function() {
            // Populate form with current data
            document.getElementById('profile-name-input').value = state.profile.name;

            // Highlight current emoji
            document.querySelectorAll('.emoji-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.emoji === state.profile.emoji) {
                    option.classList.add('selected');
                }
            });

            // Highlight current gender
            document.querySelectorAll('.gender-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.gender === state.profile.gender) {
                    option.classList.add('selected');
                }
            });

            profileEditModal.classList.add('active');
        });

        // Add touch event for mobile
        editProfileBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        // Emoji selection
        document.querySelectorAll('.emoji-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.emoji-option').forEach(opt =>
                    opt.classList.remove('selected')
                );
                this.classList.add('selected');
            });

            // Add touch event for mobile
            option.addEventListener('touchstart', function(e) {
                e.preventDefault();
                this.click();
            }, { passive: false });
        });

        // Gender selection
        genderOptions.forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.gender-option').forEach(opt =>
                    opt.classList.remove('selected')
                );
                this.classList.add('selected');
            });

            // Add touch event for mobile
            option.addEventListener('touchstart', function(e) {
                e.preventDefault();
                this.click();
            }, { passive: false });
        });

        // Save profile
        profileEditSave.addEventListener('click', function() {
            const newName = document.getElementById('profile-name-input').value.trim();
            const selectedEmoji = document.querySelector('.emoji-option.selected');
            const selectedGender = document.querySelector('.gender-option.selected');

            if (!newName) {
                showToast("Per favore inserisci un nome");
                return;
            }

            if (!selectedEmoji) {
                showToast("Seleziona un'emoji");
                return;
            }

            if (!selectedGender) {
                showToast("Seleziona un genere");
                return;
            }

            state.profile.name = newName;
            state.profile.gender = selectedGender.dataset.gender;
            state.profile.emoji = selectedEmoji.dataset.emoji;

            // Update UI
            document.querySelector('.profile-name').textContent = newName;
            document.querySelector('.profile-emoji').textContent = selectedEmoji.dataset.emoji;
            updateWelcomeMessage();

            // Salva i dati
            saveData();

            profileEditModal.classList.remove('active');
            showToast("Profilo aggiornato con successo!");
        });

        // Add touch event for mobile
        profileEditSave.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        // Cancel profile edit
        profileEditCancel.addEventListener('click', function() {
            profileEditModal.classList.remove('active');
        });

        // Add touch event for mobile
        profileEditCancel.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        // Gratitude form
        gratitudeForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const today = getLocalDateString();

            const inputs = this.querySelectorAll('.gratitude-input');
            const entries = Array.from(inputs).map(input => input.value.trim());

            state.gratitudeEntries[today] = entries;
            showToast("Diario della gratitudine salvato!");
            this.reset();

            // Salva i dati
            saveData();

            // Blocca il diario fino al giorno successivo
            checkGratitudeLock();
        });

        // Reminder toggle changes - removed toast
        document.querySelectorAll('.reminder-toggle').forEach(toggle => {
            toggle.addEventListener('change', function() {
                const type = this.dataset.type;
                state.reminders[type].active = this.checked;
                saveData();
            });
        });

        // Reminder interval changes - removed toast
        document.querySelectorAll('.reminder-interval').forEach(input => {
            input.addEventListener('change', function() {
                const type = this.dataset.type;
                state.reminders[type].interval = parseInt(this.value);
                saveData();
            });
        });

        // Reminder sound changes - removed toast
        document.querySelectorAll('.reminder-sound').forEach(select => {
            select.addEventListener('change', function() {
                const type = this.dataset.type;
                state.reminders[type].sound = this.value;
                saveData();
            });
        });

        // Time input changes - removed toast
        document.querySelectorAll('.time-input').forEach(input => {
            input.addEventListener('change', function() {
                const type = this.closest('.reminder-item').querySelector('.reminder-toggle').dataset.type;
                const index = Array.from(input.closest('.time-range').querySelectorAll('.time-input')).indexOf(input);

                if (index === 0) {
                    state.reminders[type].from = this.value;
                } else {
                    state.reminders[type].to = this.value;
                }

                saveData();
            });
        });

        // Subscribe buttons
        monthlySubscribeBtn.addEventListener('click', function() {
            mostraPianiEAcquista("mensile");
        });

        // Add touch event for mobile
        monthlySubscribeBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        annualSubscribeBtn.addEventListener('click', function() {
            mostraPianiEAcquista("annuale");
        });

        // Add touch event for mobile
        annualSubscribeBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        // Restore purchases
        restorePurchasesBtn.addEventListener('click', ripristinaAcquisti);

        // Login modal
        loginBtn.addEventListener('click', function() {
            loginModal.classList.add('active');
        });

        // Add touch event for mobile
        loginBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        loginCloseBtn.addEventListener('click', function() {
            loginModal.classList.remove('active');
        });

        // Add touch event for mobile
        loginCloseBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        // Google login
        googleLoginBtn.addEventListener('click', function() {
            // Simulazione autenticazione con Supabase
            showToast("Accesso con Google in corso...");
            setTimeout(() => {
                state.isLoggedIn = true;
                saveData();
                updateLoginState();
                loginModal.classList.remove('active');
                showToast("Accesso effettuato con successo!");
            }, 1500);
        });

        // Add touch event for mobile
        googleLoginBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        // Logout
        logoutBtn.addEventListener('click', function() {
            state.isLoggedIn = false;
            saveData();
            updateLoginState();
            showToast("Sei uscito con successo");
        });

        // Journey buttons
        journey1Btn.addEventListener('click', function() {
            const journey = state.journeys.anxiety;

            // Verifica se il percorso Ã¨ sbloccato
            if (!journey.unlocked) {
                showToast(`Questo percorso Ã¨ bloccato!`);
                return;
            }

            // Se Ã¨ il primo giorno e non Ã¨ stato ancora iniziato
            if (journey.completedDays.length === 0 && journey.currentDay === 1) {
                journey.startDate = new Date().toISOString();
                saveData();
            }

            openJourneyDetail('anxiety');
        });

        // Add touch event for mobile
        journey1Btn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        journey2Btn.addEventListener('click', function() {
            const journey = state.journeys.focus;

            // Verifica se il percorso Ã¨ sbloccato
            if (!journey.unlocked) {
                showToast(`Completa il primo percorso per sbloccare questo!`);
                return;
            }

            // Se Ã¨ il primo giorno e non Ã¨ stato ancora iniziato
            if (journey.completedDays.length === 0 && journey.currentDay === 1) {
                journey.startDate = new Date().toISOString();
                saveData();
            }

            openJourneyDetail('focus');
        });

        // Add touch event for mobile
        journey2Btn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        journey3Btn.addEventListener('click', function() {
            const journey = state.journeys.habit;

            // Verifica se il percorso Ã¨ sbloccato
            if (!journey.unlocked) {
                showToast(`Completa il secondo percorso per sbloccare questo!`);
                return;
            }

            // Se Ã¨ il primo giorno e non Ã¨ stato ancora iniziato
            if (journey.completedDays.length === 0 && journey.currentDay === 1) {
                journey.startDate = new Date().toISOString();
                saveData();
            }

            openJourneyDetail('habit');
        });

        // Add touch event for mobile
        journey3Btn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        // Funzione di completamento attivitÃ 
        taskCheckbox.addEventListener('change', function() {
            const journeyId = journeyModalContainer.dataset.journeyId;
            const journey = state.journeys[journeyId];
            const currentDay = journey.currentDay;

            if (this.checked) {
                // Aggiungi il giorno ai completati se non Ã¨ giÃ  presente
                if (!journey.completedDays.includes(currentDay)) {
                    journey.completedDays.push(currentDay);
                }

                // Aggiorna il messaggio di congratulazioni
                let congrats = "";
                switch(state.profile.gender) {
                    case "M":
                        congrats = "Bravo!";
                        break;
                    case "F":
                        congrats = "Brava!";
                        break;
                    default:
                        congrats = "Bravo/a!";
                }
                taskCompleted.innerHTML = `<i class="fas fa-check-circle"></i> AttivitÃ  completata! ${congrats}`;
                taskCompleted.style.display = 'block';

                // Sblocca il percorso successivo se necessario
                if (journeyId === 'anxiety' && journey.completedDays.length === journey.duration) {
                    state.journeys.focus.unlocked = true;
                    showToast('Percorso completato! Il percorso "Concentrazione" Ã¨ stato sbloccato!');
                }

                if (journeyId === 'focus' && journey.completedDays.length === journey.duration) {
                    state.journeys.habit.unlocked = true;
                    showToast('Percorso completato! Il percorso "Abitudini" Ã¨ stato sbloccato!');
                }

                // Salva lo stato
                saveData();

                // Aggiorna la visualizzazione
                updateJourneysDisplay();
                openJourneyDetail(journeyId); // Aggiorna il modale con i nuovi dati
            } else {
                // Rimuovi il giorno dai completati
                const index = journey.completedDays.indexOf(currentDay);
                if (index !== -1) {
                    journey.completedDays.splice(index, 1);
                }
                taskCompleted.style.display = 'none';
                saveData();
                updateJourneysDisplay();
                openJourneyDetail(journeyId);
            }
        });

        // Chiudi il modale dei percorsi
        journeyCloseBtn.addEventListener('click', function() {
            journeyModal.classList.remove('active');
        });

        // Add touch event for mobile
        journeyCloseBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.click();
        }, { passive: false });

        // Toggle theme
        themeToggle.addEventListener('click', function() {
            state.darkTheme = !state.darkTheme;
            saveData();
            updateTheme();
        });

        // Toggle theme from profile
        if (themeToggleInput) {
            themeToggleInput.addEventListener('change', function() {
                state.darkTheme = this.checked;
                saveData();
                updateTheme();
            });
        }

        // Helper functions
        function getMoodName(mood) {
            const names = {
                'devastato': 'Devastato',
                'stressato': 'Stressato',
                'arrabbiato': 'Arrabbiato',
                'triste': 'Triste',
                'neutro': 'Neutro',
                'calmo': 'Calmo',
                'contento': 'Contento',
                'felice': 'Felice',
                'entusiasta': 'Entusiasta',
                'amore': 'Amore'
            };
            return names[mood] || mood;
        }

        function getMoodEmoji(mood) {
            const emojis = {
                'devastato': 'ðŸ˜­',
                'stressato': 'ðŸ˜©',
                'arrabbiato': 'ðŸ˜ ',
                'triste': 'ðŸ˜”',
                'neutro': 'ðŸ˜',
                'calmo': 'ðŸ˜Œ',
                'contento': 'ðŸ™‚',
                'felice': 'ðŸ˜Š',
                'entusiasta': 'ðŸ˜„',
                'amore': 'ðŸ˜'
            };
            return emojis[mood] || '';
        }

        function getMoodValue(mood) {
            const values = {
                'devastato': 1,
                'stressato': 2,
                'arrabbiato': 3,
                'triste': 4,
                'neutro': 5,
                'calmo': 6,
                'contento': 7,
                'felice': 8,
                'entusiasta': 9,
                'amore': 10
            };
            return values[mood] || 5;
        }

        function showToast(message, isReminder = false) {
            const emoji = isReminder ? 'ðŸ””' : 'ðŸŒ¸';
            toast.innerHTML = `<span>${emoji}</span> ${message}`;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function playNotificationSound(type) {
            try {
                const soundFile = soundFiles[type];
                const audio = new Audio(soundFile);
                audio.play().catch(e => console.log("Impossibile riprodurre il suono:", e));
            } catch (e) {
                console.log("Errore nella riproduzione del suono:", e);
            }
        }

        function showSystemNotification(message, type) {
            // Verifica se siamo su un dispositivo mobile
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

            if (Notification.permission === "granted") {
                // Notifiche di sistema
                new Notification("Vivi Consapevolmente", {
                    body: message,
                    icon: 'https://cdn-icons-png.flaticon.com/512/1998/1998662.png'
                });

                // Riproduci il suono di notifica specifico
                playNotificationSound(type);
            } else if (isMobile) {
                // Fallback per mobile se le notifiche non sono permesse
                alert(`Notifica: ${message}`);
                playNotificationSound(type);
            }
        }

        function updateHistoryDisplay(date) {
            const selectedDate = getLocalDateString(date);

            const moodEntries = state.moodEntries[selectedDate] || [];
            const gratitudeEntries = state.gratitudeEntries[selectedDate] || [];
            const dailyGoal = state.dailyGoals[selectedDate] || null;
            const dailyIntention = state.dailyIntentions[selectedDate] || null;
            const meditationEntries = state.meditationHistory[selectedDate] || [];

            // Update mood history
            moodHistoryContainer.innerHTML = '';
            if (moodEntries.length > 0) {
                moodEntries.forEach(entry => {
                    const moodItem = document.createElement('div');
                    moodItem.className = 'mood-history-item';
                    moodItem.style.display = 'flex';
                    moodItem.style.alignItems = 'center';
                    moodItem.style.padding = '10px';
                    moodItem.style.borderBottom = '1px solid #f1f5f9';

                    moodItem.innerHTML = `
                        <div style="font-size: 2rem; margin-right: 15px;">${getMoodEmoji(entry.mood)}</div>
                        <div>
                            <div>${getMoodName(entry.mood)}</div>
                            <div style="font-size: 0.8rem; color: var(--text-light);">${state.timeWindows.find(w => w.id === entry.window).name}</div>
                        </div>
                    `;

                    moodHistoryContainer.appendChild(moodItem);
                });
            } else {
                moodHistoryContainer.innerHTML = '<p style="text-align: center; padding: 10px; color: var(--text-light);">Nessun umore registrato in questa data</p>';
            }

            // Update gratitude history
            gratitudeHistoryContainer.innerHTML = '';
            if (gratitudeEntries.length > 0) {
                const list = document.createElement('ol');
                list.style.paddingLeft = '20px';
                list.style.marginTop = '10px';

                gratitudeEntries.forEach(entry => {
                    const item = document.createElement('li');
                    item.style.marginBottom = '8px';
                    item.textContent = entry;
                    list.appendChild(item);
                });

                gratitudeHistoryContainer.appendChild(list);
            } else {
                gratitudeHistoryContainer.innerHTML = '<p style="text-align: center; padding: 10px; color: var(--text-light);">Nessun diario della gratitudine in questa data</p>';
            }

            // Update goal history
            goalHistoryContainer.innerHTML = '';
            if (dailyGoal) {
                const goalItem = document.createElement('div');
                goalItem.className = 'goal-history-item';

                goalItem.innerHTML = `
                    <div class="goal-history-icon ${dailyGoal.completed ? 'completed' : 'not-completed'}">
                        ${dailyGoal.completed ? 'âœ“' : 'âœ—'}
                    </div>
                    <div>
                        <div style="font-weight: ${dailyGoal.completed ? 'normal' : 'bold'}">${dailyGoal.text}</div>
                        <div style="font-size: 0.85rem; color: var(--text-light);">
                            ${dailyGoal.completed ? 'Completato' : 'Non completato'}
                        </div>
                    </div>
                `;

                goalHistoryContainer.appendChild(goalItem);
            } else {
                goalHistoryContainer.innerHTML = '<p style="text-align: center; padding: 10px; color: var(--text-light);">Nessun obiettivo in questa data</p>';
            }

            // Update mood average and indicator
            if (moodEntries.length > 0) {
                const moodSum = moodEntries.reduce((sum, entry) => sum + getMoodValue(entry.mood), 0);
                const average = moodSum / moodEntries.length;
                const percentage = (average - 1) / 9 * 100; // Scale from 1-10 to 0-100%

                moodAverage.textContent = average.toFixed(1);
                moodIndicator.style.left = `${percentage}%`;
            } else {
                moodAverage.textContent = "0.0";
                moodIndicator.style.left = "0%";
            }
        }

        function generateCalendar() {
            // Set month title
            const monthNames = ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno",
                                "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"];
            const month = monthNames[state.currentCalendarDate.getMonth()];
            const year = state.currentCalendarDate.getFullYear();
            document.getElementById('calendar-month').textContent = `${month} ${year}`;

            // Clear calendar
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';

            // Add day headers
            const days = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
            days.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                calendar.appendChild(header);
            });

            // Get first day of month
            const firstDay = new Date(state.currentCalendarDate.getFullYear(), state.currentCalendarDate.getMonth(), 1);
            // Get last day of month
            const lastDay = new Date(state.currentCalendarDate.getFullYear(), state.currentCalendarDate.getMonth() + 1, 0);

            // Add empty cells for days before first day
            for (let i = 0; i < firstDay.getDay(); i++) {
                const empty = document.createElement('div');
                calendar.appendChild(empty);
            }

            // Add days
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const day = new Date(
                    state.currentCalendarDate.getFullYear(),
                    state.currentCalendarDate.getMonth(),
                    i
                );

                const dayString = getLocalDateString(day);

                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = i;

                if (state.moodEntries[dayString] || state.gratitudeEntries[dayString] || state.dailyGoals[dayString]) {
                    dayElement.classList.add('has-data');
                }

                // Highlight today
                const today = new Date();
                if (day.getDate() === today.getDate() &&
                    day.getMonth() === today.getMonth() &&
                    day.getFullYear() === today.getFullYear()) {
                    dayElement.classList.add('active');
                }

                dayElement.addEventListener('click', function() {
                    updateHistoryDisplay(day);
                });

                // Add touch event for mobile
                dayElement.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    this.click();
                }, { passive: false });

                calendar.appendChild(dayElement);
            }

            // Update history for today by default
            updateHistoryDisplay(new Date());
        }

        function startReminders() {
            // Clear any existing reminders
            if (window.reminderIntervals) {
                window.reminderIntervals.forEach(interval => clearInterval(interval));
            }

            window.reminderIntervals = [];

            // Setup breathing reminder
            if (state.reminders.breathing.active) {
                const interval = setInterval(() => {
                    showSystemNotification("ðŸ’¨ Ricorda di fare un respiro profondo e consapevole!", state.reminders.breathing.sound);
                }, state.reminders.breathing.interval * 60 * 1000);

                window.reminderIntervals.push(interval);
            }

            // Setup posture reminder
            if (state.reminders.posture.active) {
                const interval = setInterval(() => {
                    showSystemNotification("ðŸ§ Controlla la tua postura! Stai dritto e rilassato!", state.reminders.posture.sound);
                }, state.reminders.posture.interval * 60 * 1000);

                window.reminderIntervals.push(interval);
            }

            // Setup water reminder
            if (state.reminders.water.active) {
                const interval = setInterval(() => {
                    showSystemNotification("ðŸ’§ Ãˆ ora di bere un po' d'acqua! Mantieniti idratato!", state.reminders.water.sound);
                }, state.reminders.water.interval * 60 * 1000);

                window.reminderIntervals.push(interval);
            }
        }

        // Funzione per inizializzare il check-in basato sul tempo
        function initTimeBasedCheckin() {
            const now = new Date();
            const currentTime = now.getHours() + now.getMinutes()/100;
            const today = getLocalDateString();

            // Trova la finestra oraria attuale
            let currentWindow = null;
            for (const window of state.timeWindows) {
                if (currentTime >= window.start && currentTime <= window.end) {
                    currentWindow = window;
                    break;
                }
            }

            // Se non c'Ã¨ una finestra corrente, disabilita i pulsanti
            if (!currentWindow) {
                moodButtons.forEach(btn => btn.disabled = true);
                return;
            }

            // Controlla se l'utente ha giÃ  effettuato il check-in in questa finestra
            const hasLoggedInCurrentWindow = state.moodEntries[today]?.some(entry =>
                entry.window === currentWindow.id
            );

            // Abilita i pulsanti solo se non Ã¨ stato fatto il check-in
            moodButtons.forEach(btn => {
                btn.disabled = hasLoggedInCurrentWindow;
            });
        }

        // Initialize the app
        if (document.querySelector('#health.section.active')) {
            initTimeBasedCheckin();
        }

        startReminders();
        generateCalendar();

        // Aggiorna periodicamente lo stato del check-in SOLO SE NELLA PAGINA SALUTE
        setInterval(() => {
            if (document.querySelector('#health.section.active')) {
                initTimeBasedCheckin();
                updateMoodStatusMessage();
            }
        }, 60000); // Ogni minuto

        // Verifica se gli obiettivi delle giornate precedenti sono stati completati
        function checkPreviousDayGoals() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = getLocalDateString(yesterday);

            // Se esiste un obiettivo per ieri ma non Ã¨ stato ancora completato
            if (state.dailyGoals[yesterdayStr] && !state.dailyGoals[yesterdayStr].completed) {
                // Non modifichiamo lo stato, solo per riferimento
                console.log("Obiettivo di ieri non completato");
            }
        }

        // Esegui il controllo all'avvio
        checkPreviousDayGoals();

        // Request notification permission
        if (!("Notification" in window)) {
            console.log("This browser does not support system notifications");
        } else {
            Notification.requestPermission();
        }

        // Filtri meditazioni
        filterBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const filter = this.dataset.filter;

                // Aggiorna stato pulsanti filtro
                filterBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                // Filtra le meditazioni
                meditationItems.forEach(item => {
                    if (filter === 'all' || item.dataset.tags.includes(filter)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });

            // Add touch event for mobile
            btn.addEventListener('touchstart', function(e) {
                e.preventDefault();
                this.click();
            }, { passive: false });
        });

        // Terms and Privacy
        termsBtn.addEventListener('click', function() {
            alert("Qui verrebbero mostrati i Termini di Servizio completi. In un'implementazione reale, questa sarebbe una pagina separata o un modale con il testo completo.");
        });

        privacyBtn.addEventListener('click', function() {
            alert("Qui verrebbe mostrata la Privacy Policy completa. In un'implementazione reale, questa sarebbe una pagina separata o un modale con il testo completo.");
        });

        // Terms and Privacy links in onboarding
        termsLink.addEventListener('click', function(e) {
            e.preventDefault();
            alert("Termini di Servizio");
        });

        privacyLink.addEventListener('click', function(e) {
            e.preventDefault();
            alert("Privacy Policy");
        });

        // Delete account
        deleteAccountBtn.addEventListener('click', function() {
            if(confirm("Sei sicuro di voler eliminare il tuo account? Questa azione Ã¨ irreversibile e cancellerÃ  tutti i tuoi dati.")) {
                // Simulazione cancellazione account
                showToast("Account in fase di cancellazione...");

                // Simulazione chiamata al server per cancellare l'account
                setTimeout(() => {
                    // Cancella i dati locali
                    localStorage.clear();

                    // Reindirizza alla pagina di accesso
                    window.location.reload();
                }, 2000);
            }
        });
    });
</script>

    <!-- Aggiungi il SDK RevenueCat -->
    <script src="https://cdn.revenuecat.com/purchases-js/5.7.0/purchases.min.js"></script>
</body>
</html>
