<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vivi Consapevolmente</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0d9488;
            --primary-light: #5eead4;
            --primary-dark: #115e59;
            --background: #f0fdfa;
            --card-bg: #ffffff;
            --text: #334155;
            --text-light: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding-bottom: 100px;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            width: 100%;
            padding: 0 15px;
            margin: 0 auto;
        }

        /* Sezioni */
        .section {
            display: none;
            padding: 20px 15px 120px;
            animation: fadeIn 0.4s ease-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-top: 15px;
        }

        .header h1 {
            font-size: 1.8rem;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }

        .header p {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        /* Card */
        .card {
            background: var(--card-bg);
            border-radius: 18px;
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .card-title {
            font-size: 1.25rem;
            color: var(--primary-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Daily Card */
        .daily-card {
            position: relative;
            height: 200px;
            border-radius: 18px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .daily-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .daily-card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            padding: 20px;
            color: white;
        }

        .daily-card-overlay h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        /* Mood Tracker */
        .mood-tracker {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }

        .mood-btn {
            background: none;
            border: none;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px;
            border-radius: 50%;
        }

        .mood-btn:hover {
            transform: scale(1.15);
            background: rgba(94, 234, 212, 0.2);
        }

        .mood-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .mood-status {
            text-align: center;
            padding: 8px;
            border-radius: 12px;
            background: rgba(94, 234, 212, 0.2);
            color: var(--primary-dark);
            font-size: 0.9rem;
            margin: 10px 0;
        }

        /* Meditations */
        .meditation-list {
            display: grid;
            gap: 15px;
        }

        .meditation-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .meditation-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .meditation-icon {
            width: 50px;
            height: 50px;
            background: rgba(94, 234, 212, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary);
            margin-right: 15px;
        }

        .meditation-info {
            flex: 1;
        }

        .meditation-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .meditation-desc {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .meditation-rating {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: var(--warning);
        }

        /* Meditation Player */
        .player-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .player-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .player-container {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .player-header {
            padding: 20px;
            text-align: center;
            background: var(--primary);
            color: white;
        }

        .player-body {
            padding: 25px 20px;
        }

        .player-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .player-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .player-btn:hover {
            transform: scale(1.1);
            background: var(--primary-dark);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .player-close {
            display: block;
            width: 100%;
            padding: 12px;
            background: #f1f5f9;
            color: var(--text);
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: 20px;
        }

        .player-close:hover {
            background: #e2e8f0;
        }

        .player-review-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #f1f5f9;
        }

        .player-review-title {
            text-align: center;
            margin-bottom: 15px;
            color: var(--primary-dark);
            font-weight: 600;
        }

        .player-review-stars {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 15px;
        }

        .player-review-star {
            font-size: 1.8rem;
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .player-review-star.active, .player-review-star:hover {
            color: var(--warning);
        }

        .player-review-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .player-review-btn:hover {
            background: var(--primary-dark);
        }

        /* History Modal */
        .history-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .history-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .history-container {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            padding: 25px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .history-title {
            font-size: 1.5rem;
            color: var(--primary-dark);
        }

        .history-close {
            font-size: 1.8rem;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .history-close:hover {
            background: #f1f5f9;
            color: var(--text);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .mood-bar-container {
            margin: 20px 0;
        }

        .mood-bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .mood-bar {
            height: 20px;
            width: 100%;
            background: linear-gradient(to right, #ef4444, #f59e0b, #10b981);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .mood-bar-indicator {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 6px;
            background: white;
            border-radius: 3px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
        }

        .history-section {
            margin-bottom: 30px;
        }

        .history-section-title {
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary-light);
        }

        /* Calendar */
        .calendar-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
        }

        .calendar-nav-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--primary);
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .calendar-nav-btn:hover {
            background: rgba(94, 234, 212, 0.2);
        }

        .calendar-month {
            font-weight: 600;
            color: var(--primary-dark);
        }

        .calendar-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .calendar-header {
            text-align: center;
            font-weight: 600;
            padding: 8px 0;
            color: var(--primary-dark);
        }

        .calendar-day {
            text-align: center;
            padding: 10px 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-day:hover {
            background: rgba(94, 234, 212, 0.2);
        }

        .calendar-day.active {
            background: var(--primary);
            color: white;
        }

        .calendar-day.has-data {
            position: relative;
        }

        .calendar-day.has-data::after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 5px;
            height: 5px;
            background: var(--primary);
            border-radius: 50%;
        }

        /* Profile Edit Modal */
        .profile-edit-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .profile-edit-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .profile-edit-container {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            padding: 25px;
        }

        .profile-edit-title {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary-dark);
        }

        .emoji-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .emoji-option {
            font-size: 2rem;
            text-align: center;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .emoji-option:hover, .emoji-option.selected {
            background: rgba(94, 234, 212, 0.2);
            transform: scale(1.1);
        }

        .profile-edit-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 20px;
            background: #f8fafc;
            font-size: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .profile-edit-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .profile-edit-buttons button {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .profile-edit-cancel {
            background: #f1f5f9;
            color: var(--text);
        }

        .profile-edit-cancel:hover {
            background: #e2e8f0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .profile-edit-save {
            background: var(--primary);
            color: white;
        }

        .profile-edit-save:hover {
            background: var(--primary-dark);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* Gender Selection */
        .gender-selection {
            margin-bottom: 20px;
        }

        .gender-options {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .gender-option {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        .gender-option.selected {
            border-color: var(--primary);
            background: rgba(94, 234, 212, 0.1);
            color: var(--primary-dark);
            font-weight: 500;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 120px;
            right: 15px;
            background: var(--primary-dark);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 100;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.4s ease;
            max-width: 300px;
            font-size: 0.95rem;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Navigation Bar */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08);
            z-index: 100;
            display: flex;
            padding: 12px 0;
            border-top: 1px solid #f1f5f9;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 0;
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.75rem;
            transition: all 0.3s ease;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-icon {
            font-size: 1.4rem;
            margin-bottom: 4px;
        }

        /* Reminder Settings */
        .reminder-settings {
            display: grid;
            gap: 15px;
            margin-top: 15px;
        }

        .reminder-item {
            background: rgba(94, 234, 212, 0.1);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(13, 148, 136, 0.2);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        .reminder-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .reminder-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .reminder-control {
            display: flex;
            flex-direction: column;
        }

        .reminder-control label {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .reminder-control select,
        .reminder-control input {
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            font-size: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%230d9488' viewBox='0 0 16 16'%3E%3Cpath d='M8 11.5a.5.5 0 0 1-.354-.854l3.646-3.646a.5.5 0 0 1 .708.708L8.707 11.5a.5.5 0 0 1-.707 0z'/%3E%3Cpath d='M8 4.5a.5.5 0 0 1 .354.854l-3.646 3.646a.5.5 0 0 1-.708-.708L7.293 4.5a.5.5 0 0 1 .707 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
        }

        .reminder-control input {
            background-image: none;
        }

        .save-reminders {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 12px;
            font-weight: 500;
            margin-top: 10px;
            cursor: pointer;
            transition: background 0.3s ease;
            width: 100%;
            font-size: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .save-reminders:hover {
            background: var(--primary-dark);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        /* Gratitude Diary */
        .gratitude-form {
            display: grid;
            gap: 12px;
        }

        .gratitude-input {
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            background: #f8fafc;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .gratitude-input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(94, 234, 212, 0.3);
        }

        .gratitude-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: 10px;
            font-size: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .gratitude-btn:hover {
            background: var(--primary-dark);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        /* Profile Section Styles */
        .profile-header {
            display: flex;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 15px;
        }

        .profile-emoji {
            font-size: 3rem;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(94, 234, 212, 0.2);
            border-radius: 50%;
            margin-right: 20px;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }

        .profile-welcome {
            color: var(--text-light);
            font-size: 1rem;
        }

        .profile-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 16px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .profile-item:hover {
            background: rgba(94, 234, 212, 0.1);
            transform: translateY(-2px);
        }

        .profile-icon {
            width: 50px;
            height: 50px;
            background: rgba(94, 234, 212, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--primary);
            margin-right: 15px;
        }

        .profile-text {
            font-weight: 500;
            color: var(--text);
        }

        /* Responsive */
        @media (min-width: 768px) {
            .container {
                max-width: 750px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .daily-card {
                height: 250px;
            }

            .nav-bar {
                padding: 15px 0;
            }
        }

        /* Mobile adjustments for reminder items */
        @media (max-width: 768px) {
            .reminder-item {
                min-height: auto; /* Rimuove l'altezza minima fissa */
                padding: 12px; /* Riduci il padding */
            }

            .reminder-controls {
                grid-template-columns: 1fr; /* Cambia a una colonna su mobile */
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="header">
                <h1 id="welcome-header">Bentornato!</h1>
                <p>Prenditi un momento per te oggi</p>
            </div>

            <div class="daily-card">
                <img src="images/logo-vivi-consapevolmente.png" alt="Logo Vivi Consapevolmente">
                <div class="daily-card-overlay">
                    <h3>Pensiero del Giorno</h3>
                    <p>"La pace viene da dentro. Non cercarla fuori." - Buddha</p>
                </div>
            </div>

            <!-- Daily inspiration card -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-lightbulb"></i>
                    <span>Consiglio del Giorno</span>
                </div>
                <p>Dedica almeno 5 minuti alla meditazione oggi. Trova un luogo tranquillo, siediti comodamente e concentrati sul tuo respiro.</p>
            </div>
        </section>

        <!-- Meditations Section -->
        <section id="meditations" class="section">
            <div class="header">
                <h1>Meditazioni Guidate</h1>
                <p>Trova la tua pace interiore</p>
            </div>

            <div class="meditation-list">
                <div class="meditation-item" data-id="1" data-title="Meditazione del Respiro">
                    <div class="meditation-icon">
                        <i class="fas fa-wind"></i>
                    </div>
                    <div class="meditation-info">
                        <div class="meditation-title">Meditazione del Respiro</div>
                        <div class="meditation-desc">10 minuti di calma e concentrazione</div>
                        <div class="meditation-rating" style="display: none;"></div>
                    </div>
                </div>

                <div class="meditation-item" data-id="2" data-title="Scansione Corporea">
                    <div class="meditation-icon">
                        <i class="fas fa-spa"></i>
                    </div>
                    <div class="meditation-info">
                        <div class="meditation-title">Scansione Corporea</div>
                        <div class="meditation-desc">Rilascia le tensioni nel corpo</div>
                        <div class="meditation-rating" style="display: none;"></div>
                    </div>
                </div>

                <div class="meditation-item" data-id="3" data-title="Rilassamento Profondo">
                    <div class="meditation-icon">
                        <i class="fas fa-moon"></i>
                    </div>
                    <div class="meditation-info">
                        <div class="meditation-title">Rilassamento Profondo</div>
                        <div class="meditation-desc">Per un sonno riposante</div>
                        <div class="meditation-rating" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Health Section -->
        <section id="health" class="section">
            <div class="header">
                <h1>Monitor Salute</h1>
                <p>Tieni traccia del tuo benessere</p>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-heartbeat"></i>
                    <span>Check-in Umore</span>
                </div>
                <div class="mood-status">
                    √à ora per il tuo check-in del pomeriggio!
                </div>
                <div class="mood-tracker">
                    <button class="mood-btn" data-mood="stressato">üò©</button>
                    <button class="mood-btn" data-mood="triste">üòî</button>
                    <button class="mood-btn" data-mood="neutro">üòê</button>
                    <button class="mood-btn" data-mood="calmo">üòä</button>
                    <button class="mood-btn" data-mood="felice">üòÑ</button>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-book"></i>
                    <span>Diario della Gratitudine</span>
                </div>
                <form class="gratitude-form">
                    <input type="text" placeholder="1. Oggi sono grato/a per..." required class="gratitude-input">
                    <input type="text" placeholder="2. Un'altra cosa che apprezzo..." required class="gratitude-input">
                    <input type="text" placeholder="3. E infine sono grato/a per..." required class="gratitude-input">
                    <button type="submit" class="gratitude-btn">Salva le note di oggi</button>
                </form>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-bell"></i>
                    <span>Promemoria Benessere</span>
                </div>
                <div class="reminder-settings">
                    <div class="reminder-item">
                        <div class="reminder-header">
                            <i class="fas fa-wind"></i>
                            <span>Respiro Consapevole</span>
                        </div>
                        <div class="reminder-controls">
                            <div class="reminder-control">
                                <label>Ogni (minuti)</label>
                                <input type="number" min="1" value="60" class="reminder-interval" data-type="breathing">
                            </div>
                            <div class="reminder-control">
                                <label>Suono</label>
                                <select class="reminder-sound" data-type="breathing">
                                    <option value="sound1">Campane</option>
                                    <option value="sound2">Natura</option>
                                    <option value="sound3">Pianoforte</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="reminder-item">
                        <div class="reminder-header">
                            <i class="fas fa-user"></i>
                            <span>Controllo Postura</span>
                        </div>
                        <div class="reminder-controls">
                            <div class="reminder-control">
                                <label>Ogni (minuti)</label>
                                <input type="number" min="1" value="45" class="reminder-interval" data-type="posture">
                            </div>
                            <div class="reminder-control">
                                <label>Suono</label>
                                <select class="reminder-sound" data-type="posture">
                                    <option value="sound1">Campane</option>
                                    <option value="sound2">Natura</option>
                                    <option value="sound3">Pianoforte</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="reminder-item">
                        <div class="reminder-header">
                            <i class="fas fa-tint"></i>
                            <span>Bere Acqua</span>
                        </div>
                        <div class="reminder-controls">
                            <div class="reminder-control">
                                <label>Ogni (minuti)</label>
                                <input type="number" min="1" value="30" class="reminder-interval" data-type="water">
                            </div>
                            <div class="reminder-control">
                                <label>Suono</label>
                                <select class="reminder-sound" data-type="water">
                                    <option value="sound1">Campane</option>
                                    <option value="sound2">Natura</option>
                                    <option value="sound3">Pianoforte</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button class="save-reminders" id="save-reminders-btn">Salva Impostazioni</button>
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profile" class="section">
            <div class="profile-header">
                <div class="profile-emoji">üòä</div>
                <div class="profile-info">
                    <div class="profile-name">Marco Rossi</div>
                    <div class="profile-welcome">Benvenuto nella tua area personale</div>
                </div>
            </div>

            <div class="card">
                <div class="profile-item" id="history-btn">
                    <div class="profile-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="profile-text">Storico e Progressi</div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-crown"></i>
                    <span>Diventa Premium</span>
                </div>
                <div class="profile-item">
                    <div class="profile-icon">
                        <i class="fab fa-google"></i>
                    </div>
                    <div class="profile-text">Accedi con Google</div>
                </div>
                <div class="profile-item">
                    <div class="profile-icon">
                        <i class="fab fa-patreon"></i>
                    </div>
                    <div class="profile-text">Sblocca Premium con Patreon</div>
                </div>
            </div>

            <div class="card">
                <div class="profile-item" id="edit-profile-btn">
                    <div class="profile-icon">
                        <i class="fas fa-user-edit"></i>
                    </div>
                    <div class="profile-text">Modifica profilo</div>
                </div>
            </div>
        </section>
    </div>

    <!-- Meditation Player Modal -->
    <div class="player-modal" id="player-modal">
        <div class="player-container">
            <div class="player-header">
                <h2 id="player-title">Meditazione del Respiro</h2>
            </div>
            <div class="player-body">
                <p id="player-description" style="text-align: center; margin-bottom: 20px; color: var(--text-light);">
                    10 minuti di calma e concentrazione
                </p>
                <div class="player-controls">
                    <button class="player-btn" id="player-back">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="player-btn" id="player-play">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="player-btn" id="player-next">
                        <i class="fas fa-step-forward"></i>
                    </button>
                </div>
                <audio id="meditation-audio" src="meditation1.mp3"></audio>

                <!-- Review Section in Player -->
                <div class="player-review-section" id="player-review-section">
                    <div class="player-review-title">Lascia una recensione</div>
                    <div class="player-review-stars">
                        <div class="player-review-star" data-value="1">‚òÖ</div>
                        <div class="player-review-star" data-value="2">‚òÖ</div>
                        <div class="player-review-star" data-value="3">‚òÖ</div>
                        <div class="player-review-star" data-value="4">‚òÖ</div>
                        <div class="player-review-star" data-value="5">‚òÖ</div>
                    </div>
                    <button class="player-review-btn" id="player-review-btn">Invia Recensione</button>
                </div>

                <button class="player-close" id="player-close-btn">Chiudi</button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="history-modal" id="history-modal">
        <div class="history-container">
            <div class="history-header">
                <div class="history-title">Storico e Progressi</div>
                <button class="history-close" id="history-close-btn">&times;</button>
            </div>

            <div class="calendar-navigation">
                <button class="calendar-nav-btn" id="prev-month-btn">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="calendar-month" id="calendar-month">Ottobre 2023</div>
                <button class="calendar-nav-btn" id="next-month-btn">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <div class="calendar-container" id="calendar">
                <!-- Calendar will be generated here -->
            </div>

            <div class="mood-bar-container">
                <div class="mood-bar-label">
                    <span>Basso</span>
                    <span>Alto</span>
                </div>
                <div class="mood-bar">
                    <div class="mood-bar-indicator" id="mood-indicator" style="left: 70%;"></div>
                </div>
                <p style="text-align: center; margin-top: 10px; color: var(--text-light);">
                    Media umore giornaliera: <span id="mood-average">3.8</span>
                </p>
            </div>

            <div class="history-section">
                <div class="history-section-title">Umore Registrato</div>
                <div class="card" id="mood-history-container">
                    <!-- Mood history will be populated here -->
                </div>
            </div>

            <div class="history-section">
                <div class="history-section-title">Diario della Gratitudine</div>
                <div class="card" id="gratitude-history-container">
                    <!-- Gratitude entries will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Edit Modal con selezione genere -->
    <div class="profile-edit-modal" id="profile-edit-modal">
        <div class="profile-edit-container">
            <h2 class="profile-edit-title">Modifica Profilo</h2>

            <div>
                <label>Nome</label>
                <input type="text" class="profile-edit-input" id="profile-name-input" placeholder="Il tuo nome">
            </div>

            <div class="gender-selection">
                <label>Genere</label>
                <div class="gender-options">
                    <div class="gender-option" data-gender="M">Maschile</div>
                    <div class="gender-option" data-gender="F">Femminile</div>
                    <div class="gender-option" data-gender="N">Neutro</div>
                </div>
            </div>

            <div>
                <label>Emoji</label>
                <div class="emoji-picker">
                    <div class="emoji-option" data-emoji="üòä">üòä</div>
                    <div class="emoji-option" data-emoji="üòÑ">üòÑ</div>
                    <div class="emoji-option" data-emoji="üòé">üòé</div>
                    <div class="emoji-option" data-emoji="üßò">üßò</div>
                    <div class="emoji-option" data-emoji="üåø">üåø</div>
                    <div class="emoji-option" data-emoji="üå∏">üå∏</div>
                    <div class="emoji-option" data-emoji="üê∂">üê∂</div>
                    <div class="emoji-option" data-emoji="ü¶ã">ü¶ã</div>
                    <div class="emoji-option" data-emoji="üåà">üåà</div>
                    <div class="emoji-option" data-emoji="üåû">üåû</div>
                    <div class="emoji-option" data-emoji="üåô">üåô</div>
                    <div class="emoji-option" data-emoji="üçÉ">üçÉ</div>
                </div>
            </div>

            <div class="profile-edit-buttons">
                <button class="profile-edit-cancel" id="profile-edit-cancel">Annulla</button>
                <button class="profile-edit-save" id="profile-edit-save">Salva</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Navigation Bar -->
    <div class="nav-bar">
        <a href="#" class="nav-item active" data-target="home">
            <div class="nav-icon"><i class="fas fa-home"></i></div>
            <div>Home</div>
        </a>
        <a href="#" class="nav-item" data-target="meditations">
            <div class="nav-icon"><i class="fas fa-spa"></i></div>
            <div>Meditazioni</div>
        </a>
        <a href="#" class="nav-item" data-target="health">
            <div class="nav-icon"><i class="fas fa-heartbeat"></i></div>
            <div>Salute</div>
        </a>
        <a href="#" class="nav-item" data-target="profile">
            <div class="nav-icon"><i class="fas fa-user"></i></div>
            <div>Profilo</div>
        </a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Funzione per ottenere la data locale
            function getLocalDateString(date = new Date()) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            // App state
            const state = {
                currentMeditation: null,
                moodEntries: {},
                gratitudeEntries: {},
                meditationReviews: {},
                timeWindows: [7, 14, 21],
                profile: {
                    name: "Marco Rossi",
                    gender: "M",
                    emoji: "üòä"
                },
                userReviewed: {},
                reminders: {
                    breathing: {
                        interval: 60,
                        sound: 'sound1',
                        active: true
                    },
                    posture: {
                        interval: 45,
                        sound: 'sound1',
                        active: true
                    },
                    water: {
                        interval: 30,
                        sound: 'sound1',
                        active: true
                    }
                },
                currentCalendarDate: new Date()
            };

            // DOM Elements
            const sections = document.querySelectorAll('.section');
            const navItems = document.querySelectorAll('.nav-item');
            const moodButtons = document.querySelectorAll('.mood-btn');
            const meditationItems = document.querySelectorAll('.meditation-item');
            const playerModal = document.getElementById('player-modal');
            const historyModal = document.getElementById('history-modal');
            const profileEditModal = document.getElementById('profile-edit-modal');
            const audioPlayer = document.getElementById('meditation-audio');
            const playBtn = document.getElementById('player-play');
            const toast = document.getElementById('toast');
            const historyBtn = document.getElementById('history-btn');
            const historyCloseBtn = document.getElementById('history-close-btn');
            const editProfileBtn = document.getElementById('edit-profile-btn');
            const moodHistoryContainer = document.getElementById('mood-history-container');
            const gratitudeHistoryContainer = document.getElementById('gratitude-history-container');
            const moodIndicator = document.getElementById('mood-indicator');
            const moodAverage = document.getElementById('mood-average');
            const saveRemindersBtn = document.getElementById('save-reminders-btn');
            const playerReviewBtn = document.getElementById('player-review-btn');
            const playerReviewStars = document.querySelectorAll('.player-review-star');
            const playerReviewSection = document.getElementById('player-review-section');
            const calendarContainer = document.getElementById('calendar');
            const calendarMonth = document.getElementById('calendar-month');
            const prevMonthBtn = document.getElementById('prev-month-btn');
            const nextMonthBtn = document.getElementById('next-month-btn');
            const genderOptions = document.querySelectorAll('.gender-option');
            const welcomeHeader = document.getElementById('welcome-header');

            // Carica dati salvati da localStorage
            function loadSavedData() {
                const savedProfile = localStorage.getItem('userProfile');
                if (savedProfile) {
                    state.profile = JSON.parse(savedProfile);
                }

                const savedMoodEntries = localStorage.getItem('moodEntries');
                if (savedMoodEntries) {
                    state.moodEntries = JSON.parse(savedMoodEntries);
                }

                const savedGratitudeEntries = localStorage.getItem('gratitudeEntries');
                if (savedGratitudeEntries) {
                    state.gratitudeEntries = JSON.parse(savedGratitudeEntries);
                }

                const savedMeditationReviews = localStorage.getItem('meditationReviews');
                if (savedMeditationReviews) {
                    state.meditationReviews = JSON.parse(savedMeditationReviews);
                }
            }

            // Salva dati in localStorage
            function saveData() {
                localStorage.setItem('userProfile', JSON.stringify(state.profile));
                localStorage.setItem('moodEntries', JSON.stringify(state.moodEntries));
                localStorage.setItem('gratitudeEntries', JSON.stringify(state.gratitudeEntries));
                localStorage.setItem('meditationReviews', JSON.stringify(state.meditationReviews));
            }

            // Simulazione salvataggio recensioni sul server
            function saveReviewToServer(meditationId, rating) {
                // Simuliamo una chiamata AJAX al server
                showToast("Recensione salvata sul server...");

                setTimeout(() => {
                    // In un'applicazione reale, qui verrebbe fatto un fetch() al server
                    showToast("Recensione pubblicata con successo! ‚úÖ");
                }, 1500);
            }

            // Funzione per aggiornare il messaggio di benvenuto in base al genere
            function updateWelcomeMessage() {
                let welcomeText = "";

                switch(state.profile.gender) {
                    case "M":
                        welcomeText = "Bentornato!";
                        break;
                    case "F":
                        welcomeText = "Bentornata!";
                        break;
                    case "N":
                        welcomeText = "Bentornat…ô!";
                        break;
                    default:
                        welcomeText = "Bentornato/a!";
                }

                welcomeHeader.textContent = welcomeText;

                const welcomeElement = document.querySelector('.profile-welcome');
                let welcomeProfileText = "";

                switch(state.profile.gender) {
                    case "M":
                        welcomeProfileText = "Benvenuto nella tua area personale";
                        break;
                    case "F":
                        welcomeProfileText = "Benvenuta nella tua area personale";
                        break;
                    case "N":
                        welcomeProfileText = "Benvenut…ô nella tua area personale";
                        break;
                    default:
                        welcomeProfileText = "Benvenuto/a nella tua area personale";
                }

                if (welcomeElement) {
                    welcomeElement.textContent = welcomeProfileText;
                }
            }

            // Initialize UI
            function initUI() {
                document.querySelector('.profile-name').textContent = state.profile.name;
                document.querySelector('.profile-emoji').textContent = state.profile.emoji;
                updateWelcomeMessage();

                // Initialize reminder settings
                document.querySelectorAll('.reminder-interval').forEach(input => {
                    const type = input.dataset.type;
                    input.value = state.reminders[type].interval;
                });

                document.querySelectorAll('.reminder-sound').forEach(select => {
                    const type = select.dataset.type;
                    select.value = state.reminders[type].sound;
                });

                // Aggiorna le valutazioni delle meditazioni
                for (const meditationId in state.meditationReviews) {
                    updateMeditationRating(meditationId);
                }
            }

            // Carica i dati salvati e inizializza l'UI
            loadSavedData();
            initUI();

            // Navigation
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.dataset.target;

                    // Update active navigation
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');

                    // Show target section
                    sections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === target) {
                            section.classList.add('active');
                        }
                    });
                });
            });

            // Mood tracking
            moodButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const mood = this.dataset.mood;
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('it-IT', {hour: '2-digit', minute:'2-digit'});

                    const today = getLocalDateString();

                    if (!state.moodEntries[today]) {
                        state.moodEntries[today] = [];
                    }
                    state.moodEntries[today].push({ mood, time: timeString });

                    showToast(`Umore registrato: ${getMoodName(mood)} ${getMoodEmoji(mood)}`);
                    moodButtons.forEach(btn => btn.disabled = true);

                    // Salva i dati
                    saveData();
                });
            });

            // Meditation player
            meditationItems.forEach(item => {
                item.addEventListener('click', function() {
                    const meditationId = this.dataset.id;
                    const meditationTitle = this.dataset.title;

                    state.currentMeditation = meditationId;

                    // Set meditation info in player
                    document.getElementById('player-title').textContent = meditationTitle;
                    document.getElementById('player-description').textContent =
                        this.querySelector('.meditation-desc').textContent;

                    // Show/hide review section based on whether user has reviewed
                    if (state.userReviewed[meditationId]) {
                        playerReviewSection.style.display = 'none';
                    } else {
                        playerReviewSection.style.display = 'block';
                        // Reset stars
                        playerReviewStars.forEach(star => star.classList.remove('active'));
                    }

                    playerModal.classList.add('active');
                });
            });

            // Player controls
            playBtn.addEventListener('click', function() {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                    playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                } else {
                    audioPlayer.pause();
                    playBtn.innerHTML = '<i class="fas fa-play"></i>';
                }
            });

            // When audio ends
            audioPlayer.addEventListener('ended', function() {
                showToast("Meditazione completata! Lascia una recensione se ti √® piaciuta.");
            });

            // Player review stars
            playerReviewStars.forEach(star => {
                star.addEventListener('click', function() {
                    const value = parseInt(this.dataset.value);

                    // Update stars display
                    playerReviewStars.forEach((s, index) => {
                        if (index < value) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                });
            });

            // Submit review from player
            playerReviewBtn.addEventListener('click', function() {
                let selectedRating = 0;
                playerReviewStars.forEach((star, index) => {
                    if (star.classList.contains('active')) {
                        selectedRating = index + 1;
                    }
                });

                if (selectedRating === 0) {
                    showToast("Seleziona una valutazione prima di inviare");
                    return;
                }

                // Save review locally
                if (!state.meditationReviews[state.currentMeditation]) {
                    state.meditationReviews[state.currentMeditation] = [];
                }
                state.meditationReviews[state.currentMeditation].push(selectedRating);
                state.userReviewed[state.currentMeditation] = true;

                // Update rating display
                updateMeditationRating(state.currentMeditation);

                // Hide review section
                playerReviewSection.style.display = 'none';

                // Save data locally
                saveData();

                // Save to server
                saveReviewToServer(state.currentMeditation, selectedRating);
            });

            // Close player
            document.getElementById('player-close-btn').addEventListener('click', function() {
                playerModal.classList.remove('active');
                audioPlayer.pause();
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
            });

            // History section
            historyBtn.addEventListener('click', function() {
                historyModal.classList.add('active');
                generateCalendar();
            });

            historyCloseBtn.addEventListener('click', function() {
                historyModal.classList.remove('active');
            });

            // Calendar navigation
            prevMonthBtn.addEventListener('click', function() {
                state.currentCalendarDate.setMonth(state.currentCalendarDate.getMonth() - 1);
                generateCalendar();
            });

            nextMonthBtn.addEventListener('click', function() {
                state.currentCalendarDate.setMonth(state.currentCalendarDate.getMonth() + 1);
                generateCalendar();
            });

            // Edit profile
            editProfileBtn.addEventListener('click', function() {
                // Populate form with current data
                document.getElementById('profile-name-input').value = state.profile.name;

                // Highlight current emoji
                document.querySelectorAll('.emoji-option').forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.emoji === state.profile.emoji) {
                        option.classList.add('selected');
                    }
                });

                // Highlight current gender
                document.querySelectorAll('.gender-option').forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.gender === state.profile.gender) {
                        option.classList.add('selected');
                    }
                });

                profileEditModal.classList.add('active');
            });

            // Emoji selection
            document.querySelectorAll('.emoji-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.emoji-option').forEach(opt =>
                        opt.classList.remove('selected')
                    );
                    this.classList.add('selected');
                });
            });

            // Gender selection
            genderOptions.forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.gender-option').forEach(opt =>
                        opt.classList.remove('selected')
                    );
                    this.classList.add('selected');
                });
            });

            // Save profile
            document.getElementById('profile-edit-save').addEventListener('click', function() {
                const newName = document.getElementById('profile-name-input').value.trim();
                const selectedEmoji = document.querySelector('.emoji-option.selected');
                const selectedGender = document.querySelector('.gender-option.selected');

                if (!newName) {
                    showToast("Per favore inserisci un nome");
                    return;
                }

                if (!selectedEmoji) {
                    showToast("Seleziona un'emoji");
                    return;
                }

                if (!selectedGender) {
                    showToast("Seleziona un genere");
                    return;
                }

                state.profile.name = newName;
                state.profile.gender = selectedGender.dataset.gender;
                state.profile.emoji = selectedEmoji.dataset.emoji;

                // Update UI
                document.querySelector('.profile-name').textContent = newName;
                document.querySelector('.profile-emoji').textContent = selectedEmoji.dataset.emoji;
                updateWelcomeMessage();

                // Salva i dati
                saveData();

                profileEditModal.classList.remove('active');
                showToast("Profilo aggiornato con successo!");
            });

            // Cancel profile edit
            document.getElementById('profile-edit-cancel').addEventListener('click', function() {
                profileEditModal.classList.remove('active');
            });

            // Gratitude form
            document.querySelector('.gratitude-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const today = getLocalDateString();

                const inputs = this.querySelectorAll('.gratitude-input');
                const entries = Array.from(inputs).map(input => input.value.trim());

                state.gratitudeEntries[today] = entries;
                showToast("Diario della gratitudine salvato!");
                this.reset();

                // Salva i dati
                saveData();
            });

            // Save reminder settings
            saveRemindersBtn.addEventListener('click', function() {
                // Update breathing reminder
                state.reminders.breathing.interval = parseInt(
                    document.querySelector('.reminder-interval[data-type="breathing"]').value
                );
                state.reminders.breathing.sound =
                    document.querySelector('.reminder-sound[data-type="breathing"]').value;

                // Update posture reminder
                state.reminders.posture.interval = parseInt(
                    document.querySelector('.reminder-interval[data-type="posture"]').value
                );
                state.reminders.posture.sound =
                    document.querySelector('.reminder-sound[data-type="posture"]').value;

                // Update water reminder
                state.reminders.water.interval = parseInt(
                    document.querySelector('.reminder-interval[data-type="water"]').value
                );
                state.reminders.water.sound =
                    document.querySelector('.reminder-sound[data-type="water"]').value;

                // Start reminders
                startReminders();

                showToast("Impostazioni promemoria salvate!", true);
            });

            // Helper functions
            function updateMeditationRating(meditationId) {
                const ratings = state.meditationReviews[meditationId];
                if (!ratings || ratings.length === 0) return;

                const average = ratings.reduce((sum, val) => sum + val, 0) / ratings.length;
                const roundedAverage = average.toFixed(1);

                // Find the meditation item and update its rating display
                meditationItems.forEach(item => {
                    if (item.dataset.id === meditationId) {
                        const ratingEl = item.querySelector('.meditation-rating');
                        if (ratingEl) {
                            ratingEl.innerHTML = `<i class="fas fa-star"></i> ${roundedAverage} (${ratings.length})`;
                            ratingEl.style.display = 'flex';
                        }
                    }
                });
            }

            function getMoodName(mood) {
                const names = {
                    'stressato': 'Stressato',
                    'triste': 'Triste',
                    'neutro': 'Neutro',
                    'calmo': 'Calmo',
                    'felice': 'Felice'
                };
                return names[mood] || mood;
            }

            function getMoodEmoji(mood) {
                const emojis = {
                    'stressato': 'üò©',
                    'triste': 'üòî',
                    'neutro': 'üòê',
                    'calmo': 'üòä',
                    'felice': 'üòÑ'
                };
                return emojis[mood] || '';
            }

            function getMoodValue(mood) {
                const values = {
                    'stressato': 1,
                    'triste': 2,
                    'neutro': 3,
                    'calmo': 4,
                    'felice': 5
                };
                return values[mood] || 3;
            }

            function showToast(message, isReminder = false) {
                toast.textContent = message;
                toast.classList.add('show');

                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);

                // Show system notification only for reminders
                if (isReminder) {
                    showSystemNotification(message);
                }
            }

            function showSystemNotification(message) {
                // Verifica se siamo su un dispositivo mobile
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

                if (!isMobile && Notification.permission === "granted") {
                    // Notifiche desktop
                    new Notification("Vivi Consapevolmente", {
                        body: message,
                        icon: 'https://cdn-icons-png.flaticon.com/512/1998/1998662.png'
                    });
                } else if (isMobile) {
                    // Notifiche mobile alternative (alert per ora)
                    alert(`Notifica: ${message}`);
                }
            }

            function updateHistoryDisplay(date) {
                const selectedDate = getLocalDateString(date);

                const moodEntries = state.moodEntries[selectedDate] || [];
                const gratitudeEntries = state.gratitudeEntries[selectedDate] || [];

                // Update mood history
                moodHistoryContainer.innerHTML = '';
                if (moodEntries.length > 0) {
                    moodEntries.forEach(entry => {
                        const moodItem = document.createElement('div');
                        moodItem.className = 'mood-history-item';
                        moodItem.style.display = 'flex';
                        moodItem.style.alignItems = 'center';
                        moodItem.style.padding = '10px';
                        moodItem.style.borderBottom = '1px solid #f1f5f9';

                        moodItem.innerHTML = `
                            <div style="font-size: 2rem; margin-right: 15px;">${getMoodEmoji(entry.mood)}</div>
                            <div>
                                <div>${getMoodName(entry.mood)}</div>
                                <div style="font-size: 0.8rem; color: var(--text-light);">${entry.time}</div>
                            </div>
                        `;

                        moodHistoryContainer.appendChild(moodItem);
                    });
                } else {
                    moodHistoryContainer.innerHTML = '<p style="text-align: center; padding: 10px; color: var(--text-light);">Nessun umore registrato in questa data</p>';
                }

                // Update gratitude history
                gratitudeHistoryContainer.innerHTML = '';
                if (gratitudeEntries.length > 0) {
                    const list = document.createElement('ol');
                    list.style.paddingLeft = '20px';
                    list.style.marginTop = '10px';

                    gratitudeEntries.forEach(entry => {
                        const item = document.createElement('li');
                        item.style.marginBottom = '8px';
                        item.textContent = entry;
                        list.appendChild(item);
                    });

                    gratitudeHistoryContainer.appendChild(list);
                } else {
                    gratitudeHistoryContainer.innerHTML = '<p style="text-align: center; padding: 10px; color: var(--text-light);">Nessun diario della gratitudine in questa data</p>';
                }

                // Update mood average and indicator
                if (moodEntries.length > 0) {
                    const moodSum = moodEntries.reduce((sum, entry) => sum + getMoodValue(entry.mood), 0);
                    const average = moodSum / moodEntries.length;
                    const percentage = (average - 1) / 4 * 100; // Scale from 1-5 to 0-100%

                    moodAverage.textContent = average.toFixed(1);
                    moodIndicator.style.left = `${percentage}%`;
                } else {
                    moodAverage.textContent = "0.0";
                    moodIndicator.style.left = "0%";
                }
            }

            function generateCalendar() {
                // Set month title
                const monthNames = ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno",
                                    "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"];
                const month = monthNames[state.currentCalendarDate.getMonth()];
                const year = state.currentCalendarDate.getFullYear();
                calendarMonth.textContent = `${month} ${year}`;

                // Clear calendar
                calendarContainer.innerHTML = '';

                // Add day headers
                const days = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
                days.forEach(day => {
                    const header = document.createElement('div');
                    header.className = 'calendar-header';
                    header.textContent = day;
                    calendarContainer.appendChild(header);
                });

                // Get first day of month
                const firstDay = new Date(state.currentCalendarDate.getFullYear(), state.currentCalendarDate.getMonth(), 1);
                // Get last day of month
                const lastDay = new Date(state.currentCalendarDate.getFullYear(), state.currentCalendarDate.getMonth() + 1, 0);

                // Add empty cells for days before first day
                for (let i = 0; i < firstDay.getDay(); i++) {
                    const empty = document.createElement('div');
                    calendarContainer.appendChild(empty);
                }

                // Add days
                for (let i = 1; i <= lastDay.getDate(); i++) {
                    const day = new Date(
                        state.currentCalendarDate.getFullYear(),
                        state.currentCalendarDate.getMonth(),
                        i
                    );

                    const dayString = getLocalDateString(day);

                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.textContent = i;

                    if (state.moodEntries[dayString] || state.gratitudeEntries[dayString]) {
                        dayElement.classList.add('has-data');
                    }

                    // Highlight today
                    const today = new Date();
                    if (day.getDate() === today.getDate() &&
                        day.getMonth() === today.getMonth() &&
                        day.getFullYear() === today.getFullYear()) {
                        dayElement.classList.add('active');
                    }

                    dayElement.addEventListener('click', function() {
                        updateHistoryDisplay(day);
                    });

                    calendarContainer.appendChild(dayElement);
                }

                // Update history for today by default
                updateHistoryDisplay(new Date());
            }

            function startReminders() {
                // Clear any existing reminders
                if (window.reminderIntervals) {
                    window.reminderIntervals.forEach(interval => clearInterval(interval));
                }

                window.reminderIntervals = [];

                // Setup breathing reminder
                if (state.reminders.breathing.active) {
                    const interval = setInterval(() => {
                        showToast("üí® Ricorda di fare un respiro profondo e consapevole!", true);
                    }, state.reminders.breathing.interval * 60 * 1000);

                    window.reminderIntervals.push(interval);
                }

                // Setup posture reminder
                if (state.reminders.posture.active) {
                    const interval = setInterval(() => {
                        showToast("üßç Controlla la tua postura! Stai dritto e rilassato!", true);
                    }, state.reminders.posture.interval * 60 * 1000);

                    window.reminderIntervals.push(interval);
                }

                // Setup water reminder
                if (state.reminders.water.active) {
                    const interval = setInterval(() => {
                        showToast("üíß √à ora di bere un po' d'acqua! Mantieniti idratato!", true);
                    }, state.reminders.water.interval * 60 * 1000);

                    window.reminderIntervals.push(interval);
                }
            }

            // Initialize time-based mood check-in
            function initTimeBasedCheckin() {
                const now = new Date();
                const currentHour = now.getHours();
                const moodStatus = document.querySelector('.mood-status');

                // Find next check-in time
                let nextWindow = state.timeWindows.find(hour => hour > currentHour);

                if (nextWindow) {
                    moodStatus.textContent = `Prossimo check-in alle ${nextWindow}:00`;
                } else {
                    moodStatus.textContent = "Check-in completati per oggi";
                }

                // Enable buttons if it's check-in time
                if (state.timeWindows.includes(currentHour)) {
                    moodStatus.textContent = `√à ora per il tuo check-in!`;
                    moodButtons.forEach(btn => btn.disabled = false);
                }
            }

            // Initialize the app
            initTimeBasedCheckin();
            startReminders();
            generateCalendar();

            // Request notification permission
            if (!("Notification" in window)) {
                console.log("This browser does not support system notifications");
            } else {
                Notification.requestPermission();
            }
        });
    </script>
</body>
</html>
